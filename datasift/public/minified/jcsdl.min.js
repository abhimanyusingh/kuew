JCSDL={};
(function(e){JCSDL.Loader={compnts:[],loaded:[],isLoaded:!1,addComponent:function(e){"function"==typeof e&&JCSDL.Loader.compnts.push(e)},addLoaded:function(e){"function"==typeof e&&JCSDL.Loader.loaded.push(e)},load:function(){var j=e.jQuery;j.each(JCSDL.Loader.compnts,function(){this.apply(JCSDL,[j])});j.each(JCSDL.Loader.loaded,function(){this.apply(JCSDL,[])});JCSDL.Loader.isLoaded=!0},timeout:function(j){setTimeout(function(){e.jQuery?(j&&e.jQuery.noConflict(),JCSDL.Loader.load()):JCSDL.Loader.timeout()},100)}};
JCSDL.onLoad=function(e){if("function"!==typeof e)return!1;JCSDL.Loader.isLoaded?e.apply(JCSDL,[]):JCSDL.Loader.addLoaded(e)}})(window);("undefined"==typeof Crypto||!Crypto.util)&&function(){var e=window.Crypto={},j=e.util={rotl:function(a,b){return a<<b|a>>>32-b},rotr:function(a,b){return a<<32-b|a>>>b},endian:function(a){if(a.constructor==Number)return j.rotl(a,8)&16711935|j.rotl(a,24)&4278255360;for(var b=0;b<a.length;b++)a[b]=j.endian(a[b]);return a},randomBytes:function(a){for(var b=[];0<a;a--)b.push(Math.floor(256*Math.random()));return b},bytesToWords:function(a){for(var b=[],d=0,f=0;d<a.length;d++,f+=8)b[f>>>5]|=(a[d]&255)<<
24-f%32;return b},wordsToBytes:function(a){for(var b=[],d=0;d<32*a.length;d+=8)b.push(a[d>>>5]>>>24-d%32&255);return b},bytesToHex:function(a){for(var b=[],d=0;d<a.length;d++)b.push((a[d]>>>4).toString(16)),b.push((a[d]&15).toString(16));return b.join("")},hexToBytes:function(a){for(var b=[],d=0;d<a.length;d+=2)b.push(parseInt(a.substr(d,2),16));return b},bytesToBase64:function(a){if("function"==typeof btoa)return btoa(b.bytesToString(a));for(var c=[],d=0;d<a.length;d+=3)for(var f=a[d]<<16|a[d+1]<<
8|a[d+2],e=0;4>e;e++)8*d+6*e<=8*a.length?c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6*(3-e)&63)):c.push("=");return c.join("")},base64ToBytes:function(a){if("function"==typeof atob)return b.stringToBytes(atob(a));a=a.replace(/[^A-Z0-9+\/]/ig,"");for(var c=[],d=0,f=0;d<a.length;f=++d%4)0!=f&&c.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d-1))&Math.pow(2,-2*f+8)-1)<<2*f|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d))>>>
6-2*f);return c}},e=e.charenc={};e.UTF8={stringToBytes:function(a){return b.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(b.bytesToString(a)))}};var b=e.Binary={stringToBytes:function(a){for(var b=[],d=0;d<a.length;d++)b.push(a.charCodeAt(d)&255);return b},bytesToString:function(a){for(var b=[],d=0;d<a.length;d++)b.push(String.fromCharCode(a[d]));return b.join("")}}}();
(function(){var e=Crypto,j=e.util,b=e.charenc,a=b.UTF8,c=b.Binary,d=e.MD5=function(a,b){var e=j.wordsToBytes(d._md5(a));return b&&b.asBytes?e:b&&b.asString?c.bytesToString(e):j.bytesToHex(e)};d._md5=function(b){b.constructor==String&&(b=a.stringToBytes(b));var c=j.bytesToWords(b),e=8*b.length;b=1732584193;for(var g=-271733879,l=-1732584194,k=271733878,q=0;q<c.length;q++)c[q]=(c[q]<<8|c[q]>>>24)&16711935|(c[q]<<24|c[q]>>>8)&4278255360;c[e>>>5]|=128<<e%32;c[(e+64>>>9<<4)+14]=e;for(var e=d._ff,n=d._gg,
p=d._hh,t=d._ii,q=0;q<c.length;q+=16){var r=b,v=g,z=l,u=k;b=e(b,g,l,k,c[q+0],7,-680876936);k=e(k,b,g,l,c[q+1],12,-389564586);l=e(l,k,b,g,c[q+2],17,606105819);g=e(g,l,k,b,c[q+3],22,-1044525330);b=e(b,g,l,k,c[q+4],7,-176418897);k=e(k,b,g,l,c[q+5],12,1200080426);l=e(l,k,b,g,c[q+6],17,-1473231341);g=e(g,l,k,b,c[q+7],22,-45705983);b=e(b,g,l,k,c[q+8],7,1770035416);k=e(k,b,g,l,c[q+9],12,-1958414417);l=e(l,k,b,g,c[q+10],17,-42063);g=e(g,l,k,b,c[q+11],22,-1990404162);b=e(b,g,l,k,c[q+12],7,1804603682);k=e(k,
b,g,l,c[q+13],12,-40341101);l=e(l,k,b,g,c[q+14],17,-1502002290);g=e(g,l,k,b,c[q+15],22,1236535329);b=n(b,g,l,k,c[q+1],5,-165796510);k=n(k,b,g,l,c[q+6],9,-1069501632);l=n(l,k,b,g,c[q+11],14,643717713);g=n(g,l,k,b,c[q+0],20,-373897302);b=n(b,g,l,k,c[q+5],5,-701558691);k=n(k,b,g,l,c[q+10],9,38016083);l=n(l,k,b,g,c[q+15],14,-660478335);g=n(g,l,k,b,c[q+4],20,-405537848);b=n(b,g,l,k,c[q+9],5,568446438);k=n(k,b,g,l,c[q+14],9,-1019803690);l=n(l,k,b,g,c[q+3],14,-187363961);g=n(g,l,k,b,c[q+8],20,1163531501);
b=n(b,g,l,k,c[q+13],5,-1444681467);k=n(k,b,g,l,c[q+2],9,-51403784);l=n(l,k,b,g,c[q+7],14,1735328473);g=n(g,l,k,b,c[q+12],20,-1926607734);b=p(b,g,l,k,c[q+5],4,-378558);k=p(k,b,g,l,c[q+8],11,-2022574463);l=p(l,k,b,g,c[q+11],16,1839030562);g=p(g,l,k,b,c[q+14],23,-35309556);b=p(b,g,l,k,c[q+1],4,-1530992060);k=p(k,b,g,l,c[q+4],11,1272893353);l=p(l,k,b,g,c[q+7],16,-155497632);g=p(g,l,k,b,c[q+10],23,-1094730640);b=p(b,g,l,k,c[q+13],4,681279174);k=p(k,b,g,l,c[q+0],11,-358537222);l=p(l,k,b,g,c[q+3],16,-722521979);
g=p(g,l,k,b,c[q+6],23,76029189);b=p(b,g,l,k,c[q+9],4,-640364487);k=p(k,b,g,l,c[q+12],11,-421815835);l=p(l,k,b,g,c[q+15],16,530742520);g=p(g,l,k,b,c[q+2],23,-995338651);b=t(b,g,l,k,c[q+0],6,-198630844);k=t(k,b,g,l,c[q+7],10,1126891415);l=t(l,k,b,g,c[q+14],15,-1416354905);g=t(g,l,k,b,c[q+5],21,-57434055);b=t(b,g,l,k,c[q+12],6,1700485571);k=t(k,b,g,l,c[q+3],10,-1894986606);l=t(l,k,b,g,c[q+10],15,-1051523);g=t(g,l,k,b,c[q+1],21,-2054922799);b=t(b,g,l,k,c[q+8],6,1873313359);k=t(k,b,g,l,c[q+15],10,-30611744);
l=t(l,k,b,g,c[q+6],15,-1560198380);g=t(g,l,k,b,c[q+13],21,1309151649);b=t(b,g,l,k,c[q+4],6,-145523070);k=t(k,b,g,l,c[q+11],10,-1120210379);l=t(l,k,b,g,c[q+2],15,718787259);g=t(g,l,k,b,c[q+9],21,-343485551);b=b+r>>>0;g=g+v>>>0;l=l+z>>>0;k=k+u>>>0}return j.endian([b,g,l,k])};d._ff=function(a,b,c,d,e,k,q){a=a+(b&c|~b&d)+(e>>>0)+q;return(a<<k|a>>>32-k)+b};d._gg=function(a,b,c,d,e,k,q){a=a+(b&d|c&~d)+(e>>>0)+q;return(a<<k|a>>>32-k)+b};d._hh=function(a,b,c,d,e,k,q){a=a+(b^c^d)+(e>>>0)+q;return(a<<k|a>>>
32-k)+b};d._ii=function(a,b,c,d,e,k,q){a=a+(c^(b|~d))+(e>>>0)+q;return(a<<k|a>>>32-k)+b};d._blocksize=16;d._digestsize=16})();JCSDL.Loader.addComponent(function(){var e=jQuery,j=function(a,c){var d,f,h,g=a.nodeName.toLowerCase();return"area"===g?(d=a.parentNode,f=d.name,a.href&&f&&"map"===d.nodeName.toLowerCase()?(h=e("img[usemap=#"+f+"]")[0],!!h&&b(h)):!1):(/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g?a.href||c:c)&&b(a)},b=function(a){return e.expr.filters.visible(a)&&!e(a).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length},a=0,c=/^ui-id-\d+$/;e.ui=e.ui||{};e.extend(e.ui,
{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});e.fn.extend({focus:function(a){return function(b,c){return"number"==typeof b?this.each(function(){var a=this;setTimeout(function(){e(a).focus();c&&c.call(a)},b)}):a.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var a;
return a=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!a.length?e(document):
a},zIndex:function(a){if(void 0!==a)return this.css("zIndex",a);if(this.length){var b,c;for(a=e(this[0]);a.length&&a[0]!==document;){if(b=a.css("position"),("absolute"===b||"relative"===b||"fixed"===b)&&(c=parseInt(a.css("zIndex"),10),!isNaN(c)&&0!==c))return c;a=a.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){c.test(this.id)&&e(this).removeAttr("id")})}});e.extend(e.expr[":"],{data:e.expr.createPseudo?
e.expr.createPseudo(function(a){return function(b){return!!e.data(b,a)}}):function(a,b,c){return!!e.data(a,c[3])},focusable:function(a){return j(a,!isNaN(e.attr(a,"tabindex")))},tabbable:function(a){var b=e.attr(a,"tabindex"),c=isNaN(b);return(c||0<=b)&&j(a,!c)}});e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(a,b){function c(a,b,v,f){return e.each(d,function(){b-=parseFloat(e.css(a,"padding"+this))||0;v&&(b-=parseFloat(e.css(a,"border"+this+"Width"))||0);f&&(b-=parseFloat(e.css(a,
"margin"+this))||0)}),b}var d="Width"===b?["Left","Right"]:["Top","Bottom"],f=b.toLowerCase(),h={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+b]=function(a){return void 0===a?h["inner"+b].call(this):this.each(function(){e(this).css(f,c(this,a)+"px")})};e.fn["outer"+b]=function(a,v){return"number"!=typeof a?h["outer"+b].call(this,a):this.each(function(){e(this).css(f,c(this,a,!0,v)+"px")})}});e.fn.addBack||(e.fn.addBack=
function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))});if(e("<a>").data("a-b","a").removeData("a-b").data("a-b")){var d=e.fn.removeData;e.fn.removeData=function(a){return arguments.length?d.call(this,e.camelCase(a)):d.call(this)}}e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());e.support.selectstart="onselectstart"in document.createElement("div");e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",
function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});e.extend(e.ui,{plugin:{add:function(a,b,c){var d;a=e.ui[a].prototype;for(d in c)a.plugins[d]=a.plugins[d]||[],a.plugins[d].push([b,c[d]])},call:function(a,b,c){var d=a.plugins[b];if(d&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(b=0;d.length>b;b++)a.options[d[b][0]]&&d[b][1].apply(a.element,c)}},hasScroll:function(a,b){if("hidden"===e(a).css("overflow"))return!1;var c=
b&&"left"===b?"scrollLeft":"scrollTop";return 0<a[c]?!0:(a[c]=1,a[c]=0,!1)}});var f=jQuery,h=void 0,m=0,g=Array.prototype.slice,l=f.cleanData;f.cleanData=function(a){for(var b,c=0;null!=(b=a[c]);c++)try{f(b).triggerHandler("remove")}catch(d){}l(a)};f.widget=function(a,b,c){var d,e,g,k,l={},m=a.split(".")[0];a=a.split(".")[1];d=m+"-"+a;c||(c=b,b=f.Widget);f.expr[":"][d.toLowerCase()]=function(a){return!!f.data(a,d)};f[m]=f[m]||{};e=f[m][a];g=f[m][a]=function(a,b){return this._createWidget?(arguments.length&&
this._createWidget(a,b),h):new g(a,b)};f.extend(g,e,{version:c.version,_proto:f.extend({},c),_childConstructors:[]});k=new b;k.options=f.widget.extend({},k.options);f.each(c,function(a,c){var d;if(f.isFunction(c)){var v=function(){return b.prototype[a].apply(this,arguments)},e=function(c){return b.prototype[a].apply(this,c)};d=(l[a]=function(){var a,b=this._super,d=this._superApply;return this._super=v,this._superApply=e,a=c.apply(this,arguments),this._super=b,this._superApply=d,a},h)}else d=(l[a]=
c,h);return d});g.prototype=f.widget.extend(k,{widgetEventPrefix:e?k.widgetEventPrefix:a},l,{constructor:g,namespace:m,widgetName:a,widgetFullName:d});e?(f.each(e._childConstructors,function(a,b){var c=b.prototype;f.widget(c.namespace+"."+c.widgetName,g,b._proto)}),delete e._childConstructors):b._childConstructors.push(g);f.widget.bridge(a,g)};f.widget.extend=function(a){for(var b,c,d=g.call(arguments,1),e=0,k=d.length;k>e;e++)for(b in d[e])c=d[e][b],d[e].hasOwnProperty(b)&&c!==h&&(a[b]=f.isPlainObject(c)?
f.isPlainObject(a[b])?f.widget.extend({},a[b],c):f.widget.extend({},c):c);return a};f.widget.bridge=function(a,b){var c=b.prototype.widgetFullName||a;f.fn[a]=function(d){var e="string"==typeof d,k=g.call(arguments,1),l=this;return d=!e&&k.length?f.widget.extend.apply(null,[d].concat(k)):d,e?this.each(function(){var b,e=f.data(this,c);return e?f.isFunction(e[d])&&"_"!==d.charAt(0)?(b=e[d].apply(e,k),b!==e&&b!==h?(l=b&&b.jquery?l.pushStack(b.get()):b,!1):h):f.error("no such method '"+d+"' for "+a+" widget instance"):
f.error("cannot call methods on "+a+" prior to initialization; attempted to call method '"+d+"'")}):this.each(function(){var a=f.data(this,c);a?a.option(d||{})._init():f.data(this,c,new b(d,this))}),l}};f.Widget=function(){};f.Widget._childConstructors=[];f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(a,b){b=f(b||this.defaultElement||this)[0];this.element=f(b);this.uuid=m++;this.eventNamespace="."+this.widgetName+
this.uuid;this.options=f.widget.extend({},this.options,this._getCreateOptions(),a);this.bindings=f();this.hoverable=f();this.focusable=f();b!==this&&(f.data(b,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===b&&this.destroy()}}),this.document=f(b.style?b.ownerDocument:b.document||b),this.window=f(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:f.noop,
_getCreateEventData:f.noop,_create:f.noop,_init:f.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(f.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},
_destroy:f.noop,widget:function(){return this.element},option:function(a,b){var c,d,e,g=a;if(0===arguments.length)return f.widget.extend({},this.options);if("string"==typeof a)if(g={},c=a.split("."),a=c.shift(),c.length){d=g[a]=f.widget.extend({},this.options[a]);for(e=0;c.length-1>e;e++)d[c[e]]=d[c[e]]||{},d=d[c[e]];if(a=c.pop(),b===h)return d[a]===h?null:d[a];d[a]=b}else{if(b===h)return this.options[a]===h?null:this.options[a];g[a]=b}return this._setOptions(g),this},_setOptions:function(a){for(var b in a)this._setOption(b,
a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(a,b,c){var d,e=this;"boolean"!=typeof a&&(c=b,b=a,a=!1);c?(b=d=f(b),this.bindings=this.bindings.add(b)):
(c=b,b=this.element,d=this.widget());f.each(c,function(c,u){function g(){return a||!0!==e.options.disabled&&!f(this).hasClass("ui-state-disabled")?("string"==typeof u?e[u]:u).apply(e,arguments):h}"string"!=typeof u&&(g.guid=u.guid=u.guid||g.guid||f.guid++);var k=c.match(/^(\w+)\s*(.*)$/),l=k[1]+e.eventNamespace;(k=k[2])?d.delegate(k,l,g):b.bind(l,g)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(b).undelegate(b)},_delay:function(a,b){var c=this;
return setTimeout(function(){return("string"==typeof a?c[a]:a).apply(c,arguments)},b||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(a){f(a.currentTarget).addClass("ui-state-hover")},mouseleave:function(a){f(a.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(a){f(a.currentTarget).addClass("ui-state-focus")},focusout:function(a){f(a.currentTarget).removeClass("ui-state-focus")}})},
_trigger:function(a,b,c){var d,e=this.options[a];if(c=c||{},b=f.Event(b),b.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase(),b.target=this.element[0],a=b.originalEvent)for(d in a)d in b||(b[d]=a[d]);return this.element.trigger(b,c),!(f.isFunction(e)&&!1===e.apply(this.element[0],[b].concat(c))||b.isDefaultPrevented())}};f.each({show:"fadeIn",hide:"fadeOut"},function(a,b){f.Widget.prototype["_"+a]=function(c,d,e){"string"==typeof d&&(d={effect:d});var h,g=d?!0===d||"number"==
typeof d?b:d.effect||b:a;d=d||{};"number"==typeof d&&(d={duration:d});h=!f.isEmptyObject(d);d.complete=e;d.delay&&c.delay(d.delay);h&&f.effects&&f.effects.effect[g]?c[a](d):g!==a&&c[g]?c[g](d.duration,d.easing,e):c.queue(function(b){f(this)[a]();e&&e.call(c[0]);b()})}});var k=jQuery,q=!1;k(document).mouseup(function(){q=!1});k.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+
this.widgetName,function(b){return a._mouseDown(b)}).bind("click."+this.widgetName,function(b){return!0===k.data(b.target,a.widgetName+".preventClickEvent")?(k.removeData(b.target,a.widgetName+".preventClickEvent"),b.stopImmediatePropagation(),!1):void 0});this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);this._mouseMoveDelegate&&k(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(a){if(!q){this._mouseStarted&&
this._mouseUp(a);this._mouseDownEvent=a;var b=this,c=1===a.which,d="string"==typeof this.options.cancel&&a.target.nodeName?k(a.target).closest(this.options.cancel).length:!1;return c&&!d&&this._mouseCapture(a)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){b.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(a),!this._mouseStarted)?(a.preventDefault(),!0):(!0===
k.data(a.target,this.widgetName+".preventClickEvent")&&k.removeData(a.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return b._mouseMove(a)},this._mouseUpDelegate=function(a){return b._mouseUp(a)},k(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),a.preventDefault(),q=!0,!0)):!0}},_mouseMove:function(a){return k.ui.ie&&(!document.documentMode||9>document.documentMode)&&!a.button?this._mouseUp(a):
this._mouseStarted?(this._mouseDrag(a),a.preventDefault()):(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,a),this._mouseStarted?this._mouseDrag(a):this._mouseUp(a)),!this._mouseStarted)},_mouseUp:function(a){return k(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,a.target===this._mouseDownEvent.target&&k.data(a.target,
this.widgetName+".preventClickEvent",!0),this._mouseStop(a)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});var n=jQuery;n.widget("ui.draggable",n.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,
appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative");this.options.addClasses&&
this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(a){var b=this.options;return this.helper||b.disabled||0<n(a.target).closest(".ui-resizable-handle").length?!1:(this.handle=this._getHandle(a),this.handle?(n(!0===b.iframeFix?"iframe":b.iframeFix).each(function(){n("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+
"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(n(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(a){var b=this.options;return this.helper=this._createHelper(a),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),n.ui.ddmanager&&(n.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=
this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,n.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(a),this.originalPageX=a.pageX,this.originalPageY=a.pageY,b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt),
this._setContainment(),!1===this._trigger("start",a)?(this._clear(),!1):(this._cacheHelperProportions(),n.ui.ddmanager&&!b.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,a),this._mouseDrag(a,!0),n.ui.ddmanager&&n.ui.ddmanager.dragStart(this,a),!0)},_mouseDrag:function(a,b){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(a),this.positionAbs=this._convertPositionTo("absolute"),!b){var c=this._uiHash();if(!1===this._trigger("drag",
a,c))return this._mouseUp({}),!1;this.position=c.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n.ui.ddmanager&&n.ui.ddmanager.drag(this,a),!1},_mouseStop:function(a){var b=this,c=!1;return n.ui.ddmanager&&!this.options.dropBehaviour&&(c=n.ui.ddmanager.drop(this,a)),this.dropped&&(c=this.dropped,this.dropped=!1),"original"!==this.options.helper||
n.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!c||"valid"===this.options.revert&&c||!0===this.options.revert||n.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)?n(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==b._trigger("stop",a)&&b._clear()}):!1!==this._trigger("stop",a)&&this._clear(),!1):!1},_mouseUp:function(a){return n("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),
n.ui.ddmanager&&n.ui.ddmanager.dragStop(this,a),n.ui.mouse.prototype._mouseUp.call(this,a)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(a){return this.options.handle?!!n(a.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(a){var b=this.options;a=n.isFunction(b.helper)?n(b.helper.apply(this.element[0],[a])):"clone"===b.helper?this.element.clone().removeAttr("id"):this.element;return a.parents("body").length||
a.appendTo("parent"===b.appendTo?this.element[0].parentNode:b.appendTo),a[0]===this.element[0]||/(fixed|absolute)/.test(a.css("position"))||a.css("position","absolute"),a},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" "));n.isArray(a)&&(a={left:+a[0],top:+a[1]||0});"left"in a&&(this.offset.click.left=a.left+this.margins.left);"right"in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left);"top"in a&&(this.offset.click.top=a.top+this.margins.top);
"bottom"in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){var a=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&n.ui.ie)&&(a={top:0,
left:0}),{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),
10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a,b,c,d=this.options;return d.containment?"window"===d.containment?(this.containment=[n(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,n(window).scrollTop()-
this.offset.relative.top-this.offset.parent.top,n(window).scrollLeft()+n(window).width()-this.helperProportions.width-this.margins.left,n(window).scrollTop()+(n(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===d.containment?(this.containment=[0,0,n(document).width()-this.helperProportions.width-this.margins.left,(n(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],
void 0):d.containment.constructor===Array?(this.containment=d.containment,void 0):("parent"===d.containment&&(d.containment=this.helper[0].parentNode),b=n(d.containment),c=b[0],c&&(a="hidden"!==b.css("overflow"),this.containment=[(parseInt(b.css("borderLeftWidth"),10)||0)+(parseInt(b.css("paddingLeft"),10)||0),(parseInt(b.css("borderTopWidth"),10)||0)+(parseInt(b.css("paddingTop"),10)||0),(a?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(b.css("borderRightWidth"),10)||0)-(parseInt(b.css("paddingRight"),
10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(a?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(b.css("borderBottomWidth"),10)||0)-(parseInt(b.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=b),void 0):(this.containment=null,void 0)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&n.contains(this.scrollParent[0],
this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:d.scrollTop(),left:d.scrollLeft()}),{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*c}},_generatePosition:function(a){var b,c,d,f,e=this.options,
h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&n.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=a.pageX,k=a.pageY;return this.offset.scroll||(this.offset.scroll={top:h.scrollTop(),left:h.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(c=this.relative_container.offset(),b=[this.containment[0]+c.left,this.containment[1]+c.top,this.containment[2]+c.left,this.containment[3]+c.top]):b=this.containment,a.pageX-
this.offset.click.left<b[0]&&(g=b[0]+this.offset.click.left),a.pageY-this.offset.click.top<b[1]&&(k=b[1]+this.offset.click.top),a.pageX-this.offset.click.left>b[2]&&(g=b[2]+this.offset.click.left),a.pageY-this.offset.click.top>b[3]&&(k=b[3]+this.offset.click.top)),e.grid&&(d=e.grid[1]?this.originalPageY+Math.round((k-this.originalPageY)/e.grid[1])*e.grid[1]:this.originalPageY,k=b?d-this.offset.click.top>=b[1]||d-this.offset.click.top>b[3]?d:d-this.offset.click.top>=b[1]?d-e.grid[1]:d+e.grid[1]:d,
f=e.grid[0]?this.originalPageX+Math.round((g-this.originalPageX)/e.grid[0])*e.grid[0]:this.originalPageX,g=b?f-this.offset.click.left>=b[0]||f-this.offset.click.left>b[2]?f:f-this.offset.click.left>=b[0]?f-e.grid[0]:f+e.grid[0]:f)),{top:k-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:g-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():
this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1},_trigger:function(a,b,c){return c=c||this._uiHash(),n.ui.plugin.call(this,a,[b,c]),"drag"===a&&(this.positionAbs=this._convertPositionTo("absolute")),n.Widget.prototype._trigger.call(this,a,b,c)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,
offset:this.positionAbs}}});n.ui.plugin.add("draggable","connectToSortable",{start:function(a,b){var c=n(this).data("ui-draggable"),d=c.options,f=n.extend({},b,{item:c.element});c.sortables=[];n(d.connectToSortable).each(function(){var b=n.data(this,"ui-sortable");b&&!b.options.disabled&&(c.sortables.push({instance:b,shouldRevert:b.options.revert}),b.refreshPositions(),b._trigger("activate",a,f))})},stop:function(a,b){var c=n(this).data("ui-draggable"),d=n.extend({},b,{item:c.element});n.each(c.sortables,
function(){this.instance.isOver?(this.instance.isOver=0,c.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(a),this.instance.options.helper=this.instance.options._helper,"original"===c.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",a,d))})},drag:function(a,b){var c=n(this).data("ui-draggable"),d=this;
n.each(c.sortables,function(){var f=!1,e=this;this.instance.positionAbs=c.positionAbs;this.instance.helperProportions=c.helperProportions;this.instance.offset.click=c.offset.click;this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,n.each(c.sortables,function(){return this.instance.positionAbs=c.positionAbs,this.instance.helperProportions=c.helperProportions,this.instance.offset.click=c.offset.click,this!==e&&this.instance._intersectsWith(this.instance.containerCache)&&n.contains(e.instance.element[0],
this.instance.element[0])&&(f=!1),f}));f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=n(d).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return b.helper[0]},a.target=this.instance.currentItem[0],this.instance._mouseCapture(a,!0),this.instance._mouseStart(a,!0,!0),this.instance.offset.click.top=c.offset.click.top,this.instance.offset.click.left=
c.offset.click.left,this.instance.offset.parent.left-=c.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=c.offset.parent.top-this.instance.offset.parent.top,c._trigger("toSortable",a),c.dropped=this.instance.element,c.currentItem=c.element,this.instance.fromOutside=c),this.instance.currentItem&&this.instance._mouseDrag(a)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",
a,this.instance._uiHash(this.instance)),this.instance._mouseStop(a,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),c._trigger("fromSortable",a),c.dropped=!1)})}});n.ui.plugin.add("draggable","cursor",{start:function(){var a=n("body"),b=n(this).data("ui-draggable").options;a.css("cursor")&&(b._cursor=a.css("cursor"));a.css("cursor",b.cursor)},stop:function(){var a=n(this).data("ui-draggable").options;
a._cursor&&n("body").css("cursor",a._cursor)}});n.ui.plugin.add("draggable","opacity",{start:function(a,b){var c=n(b.helper),d=n(this).data("ui-draggable").options;c.css("opacity")&&(d._opacity=c.css("opacity"));c.css("opacity",d.opacity)},stop:function(a,b){var c=n(this).data("ui-draggable").options;c._opacity&&n(b.helper).css("opacity",c._opacity)}});n.ui.plugin.add("draggable","scroll",{start:function(){var a=n(this).data("ui-draggable");a.scrollParent[0]!==document&&"HTML"!==a.scrollParent[0].tagName&&
(a.overflowOffset=a.scrollParent.offset())},drag:function(a){var b=n(this).data("ui-draggable"),c=b.options,d=!1;b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName?(c.axis&&"x"===c.axis||(b.overflowOffset.top+b.scrollParent[0].offsetHeight-a.pageY<c.scrollSensitivity?b.scrollParent[0].scrollTop=d=b.scrollParent[0].scrollTop+c.scrollSpeed:a.pageY-b.overflowOffset.top<c.scrollSensitivity&&(b.scrollParent[0].scrollTop=d=b.scrollParent[0].scrollTop-c.scrollSpeed)),c.axis&&"y"===c.axis||
(b.overflowOffset.left+b.scrollParent[0].offsetWidth-a.pageX<c.scrollSensitivity?b.scrollParent[0].scrollLeft=d=b.scrollParent[0].scrollLeft+c.scrollSpeed:a.pageX-b.overflowOffset.left<c.scrollSensitivity&&(b.scrollParent[0].scrollLeft=d=b.scrollParent[0].scrollLeft-c.scrollSpeed))):(c.axis&&"x"===c.axis||(a.pageY-n(document).scrollTop()<c.scrollSensitivity?d=n(document).scrollTop(n(document).scrollTop()-c.scrollSpeed):n(window).height()-(a.pageY-n(document).scrollTop())<c.scrollSensitivity&&(d=n(document).scrollTop(n(document).scrollTop()+
c.scrollSpeed))),c.axis&&"y"===c.axis||(a.pageX-n(document).scrollLeft()<c.scrollSensitivity?d=n(document).scrollLeft(n(document).scrollLeft()-c.scrollSpeed):n(window).width()-(a.pageX-n(document).scrollLeft())<c.scrollSensitivity&&(d=n(document).scrollLeft(n(document).scrollLeft()+c.scrollSpeed))));!1!==d&&n.ui.ddmanager&&!c.dropBehaviour&&n.ui.ddmanager.prepareOffsets(b,a)}});n.ui.plugin.add("draggable","snap",{start:function(){var a=n(this).data("ui-draggable"),b=a.options;a.snapElements=[];n(b.snap.constructor!==
String?b.snap.items||":data(ui-draggable)":b.snap).each(function(){var b=n(this),c=b.offset();this!==a.element[0]&&a.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(a,b){var c,d,f,e,h,g,k,l,m,q,j=n(this).data("ui-draggable"),p=j.options,r=p.snapTolerance,t=b.offset.left,x=t+j.helperProportions.width,w=b.offset.top,y=w+j.helperProportions.height;for(m=j.snapElements.length-1;0<=m;m--)h=j.snapElements[m].left,g=h+j.snapElements[m].width,
k=j.snapElements[m].top,l=k+j.snapElements[m].height,h-r>x||t>g+r||k-r>y||w>l+r||!n.contains(j.snapElements[m].item.ownerDocument,j.snapElements[m].item)?(j.snapElements[m].snapping&&j.options.snap.release&&j.options.snap.release.call(j.element,a,n.extend(j._uiHash(),{snapItem:j.snapElements[m].item})),j.snapElements[m].snapping=!1):("inner"!==p.snapMode&&(c=r>=Math.abs(k-y),d=r>=Math.abs(l-w),f=r>=Math.abs(h-x),e=r>=Math.abs(g-t),c&&(b.position.top=j._convertPositionTo("relative",{top:k-j.helperProportions.height,
left:0}).top-j.margins.top),d&&(b.position.top=j._convertPositionTo("relative",{top:l,left:0}).top-j.margins.top),f&&(b.position.left=j._convertPositionTo("relative",{top:0,left:h-j.helperProportions.width}).left-j.margins.left),e&&(b.position.left=j._convertPositionTo("relative",{top:0,left:g}).left-j.margins.left)),q=c||d||f||e,"outer"!==p.snapMode&&(c=r>=Math.abs(k-w),d=r>=Math.abs(l-y),f=r>=Math.abs(h-t),e=r>=Math.abs(g-x),c&&(b.position.top=j._convertPositionTo("relative",{top:k,left:0}).top-
j.margins.top),d&&(b.position.top=j._convertPositionTo("relative",{top:l-j.helperProportions.height,left:0}).top-j.margins.top),f&&(b.position.left=j._convertPositionTo("relative",{top:0,left:h}).left-j.margins.left),e&&(b.position.left=j._convertPositionTo("relative",{top:0,left:g-j.helperProportions.width}).left-j.margins.left)),!j.snapElements[m].snapping&&(c||d||f||e||q)&&j.options.snap.snap&&j.options.snap.snap.call(j.element,a,n.extend(j._uiHash(),{snapItem:j.snapElements[m].item})),j.snapElements[m].snapping=
c||d||f||e||q)}});n.ui.plugin.add("draggable","stack",{start:function(){var a,b=this.data("ui-draggable").options,b=n.makeArray(n(b.stack)).sort(function(a,b){return(parseInt(n(a).css("zIndex"),10)||0)-(parseInt(n(b).css("zIndex"),10)||0)});b.length&&(a=parseInt(n(b[0]).css("zIndex"),10)||0,n(b).each(function(b){n(this).css("zIndex",a+b)}),this.css("zIndex",a+b.length))}});n.ui.plugin.add("draggable","zIndex",{start:function(a,b){var c=n(b.helper),d=n(this).data("ui-draggable").options;c.css("zIndex")&&
(d._zIndex=c.css("zIndex"));c.css("zIndex",d.zIndex)},stop:function(a,b){var c=n(this).data("ui-draggable").options;c._zIndex&&n(b.helper).css("zIndex",c._zIndex)}});var p=jQuery,t=function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))};p.widget("ui.sortable",p.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,
grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?"x"===a.axis||t(this.items[0].item):
!1;this.offset=this.element.offset();this._mouseInit();this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var a=this.items.length-1;0<=a;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(a,b){"disabled"===a?(this.options[a]=b,this.widget().toggleClass("ui-sortable-disabled",!!b)):p.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(a,b){var c=null,d=!1,f=this;return this.reverting?
!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(a),p(a.target).parents().each(function(){return p.data(this,f.widgetName+"-item")===f?(c=p(this),!1):void 0}),p.data(a.target,f.widgetName+"-item")===f&&(c=p(a.target)),c?!this.options.handle||b||(p(this.options.handle,c).find("*").addBack().each(function(){this===a.target&&(d=!0)}),d)?(this.currentItem=c,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(a,b,c){var d;b=this.options;if(this.currentContainer=
this,this.refreshPositions(),this.helper=this._createHelper(a),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},p.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=
this.helper.css("position"),this.originalPosition=this._generatePosition(a),this.originalPageX=a.pageX,this.originalPageY=a.pageY,b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),b.containment&&this._setContainment(),b.cursor&&"auto"!==b.cursor&&(d=this.document.find("body"),this.storedCursor=d.css("cursor"),d.css("cursor",
b.cursor),this.storedStylesheet=p("<style>*{ cursor: "+b.cursor+" !important; }</style>").appendTo(d)),b.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",b.opacity)),b.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",b.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",a,this._uiHash()),
this._preserveHelperProportions||this._cacheHelperProportions(),!c)for(c=this.containers.length-1;0<=c;c--)this.containers[c]._trigger("activate",a,this._uiHash(this));return p.ui.ddmanager&&(p.ui.ddmanager.current=this),p.ui.ddmanager&&!b.dropBehaviour&&p.ui.ddmanager.prepareOffsets(this,a),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(a),!0},_mouseDrag:function(a){var b,c,d,f;b=this.options;var e=!1;this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");
this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<b.scrollSensitivity?this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop+b.scrollSpeed:a.pageY-this.overflowOffset.top<b.scrollSensitivity&&(this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop-b.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-
a.pageX<b.scrollSensitivity?this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft+b.scrollSpeed:a.pageX-this.overflowOffset.left<b.scrollSensitivity&&(this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft-b.scrollSpeed)):(a.pageY-p(document).scrollTop()<b.scrollSensitivity?e=p(document).scrollTop(p(document).scrollTop()-b.scrollSpeed):p(window).height()-(a.pageY-p(document).scrollTop())<b.scrollSensitivity&&(e=p(document).scrollTop(p(document).scrollTop()+b.scrollSpeed)),a.pageX-
p(document).scrollLeft()<b.scrollSensitivity?e=p(document).scrollLeft(p(document).scrollLeft()-b.scrollSpeed):p(window).width()-(a.pageX-p(document).scrollLeft())<b.scrollSensitivity&&(e=p(document).scrollLeft(p(document).scrollLeft()+b.scrollSpeed))),!1!==e&&p.ui.ddmanager&&!b.dropBehaviour&&p.ui.ddmanager.prepareOffsets(this,a));this.positionAbs=this._convertPositionTo("absolute");this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px");this.options.axis&&
"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(b=this.items.length-1;0<=b;b--)if(c=this.items[b],d=c.item[0],f=this._intersectsWithPointer(c),f&&c.instance===this.currentContainer&&d!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==d&&!p.contains(this.placeholder[0],d)&&("semi-dynamic"===this.options.type?!p.contains(this.element[0],d):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(c))break;
this._rearrange(a,c);this._trigger("change",a,this._uiHash());break}return this._contactContainers(a),p.ui.ddmanager&&p.ui.ddmanager.drag(this,a),this._trigger("sort",a,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(a,b){if(a){if(p.ui.ddmanager&&!this.options.dropBehaviour&&p.ui.ddmanager.drop(this,a),this.options.revert){var c=this,d=this.placeholder.offset(),f=this.options.axis,e={};f&&"x"!==f||(e.left=d.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===
document.body?0:this.offsetParent[0].scrollLeft));f&&"y"!==f||(e.top=d.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop));this.reverting=!0;p(this.helper).animate(e,parseInt(this.options.revert,10)||500,function(){c._clear(a)})}else this._clear(a,b);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null});"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();
for(var a=this.containers.length-1;0<=a;a--)this.containers[a]._trigger("deactivate",null,this._uiHash(this)),this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",null,this._uiHash(this)),this.containers[a].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),p.extend(this,{helper:null,dragging:!1,
reverting:!1,_noFinalSort:null}),this.domPosition.prev?p(this.domPosition.prev).after(this.currentItem):p(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(a){var b=this._getItemsAsjQuery(a&&a.connected),c=[];return a=a||{},p(b).each(function(){var b=(p(a.item||this).attr(a.attribute||"id")||"").match(a.expression||/(.+)[\-=_](.+)/);b&&c.push((a.key||b[1]+"[]")+"="+(a.key&&a.expression?b[1]:b[2]))}),!c.length&&a.key&&c.push(a.key+"="),c.join("&")},toArray:function(a){var b=
this._getItemsAsjQuery(a&&a.connected),c=[];return a=a||{},b.each(function(){c.push(p(a.item||this).attr(a.attribute||"id")||"")}),c},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,f=d+this.helperProportions.height,e=a.left,h=e+a.width,g=a.top,k=g+a.height,l=this.offset.click.top,m=this.offset.click.left,m="y"===this.options.axis||b+m>e&&h>b+m,l=("x"===this.options.axis||d+l>g&&k>d+l)&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||
"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:b+this.helperProportions.width/2>e&&h>c-this.helperProportions.width/2&&d+this.helperProportions.height/2>g&&k>f-this.helperProportions.height/2},_intersectsWithPointer:function(a){var b="y"===this.options.axis||this.positionAbs.left+this.offset.click.left>a.left&&a.left+a.width>this.positionAbs.left+this.offset.click.left;a=("x"===this.options.axis||this.positionAbs.top+
this.offset.click.top>a.top&&a.top+a.height>this.positionAbs.top+this.offset.click.top)&&b;var b=this._getDragVerticalDirection(),c=this._getDragHorizontalDirection();return a?this.floating?c&&"right"===c||"down"===b?2:1:b&&("down"===b?2:1):!1},_intersectsWithSides:function(a){var b=this.positionAbs.top+this.offset.click.top>a.top+a.height/2&&a.top+a.height/2+a.height>this.positionAbs.top+this.offset.click.top;a=this.positionAbs.left+this.offset.click.left>a.left+a.width/2&&a.left+a.width/2+a.width>
this.positionAbs.left+this.offset.click.left;var c=this._getDragVerticalDirection(),d=this._getDragHorizontalDirection();return this.floating&&d?"right"===d&&a||"left"===d&&!a:c&&("down"===c&&b||"up"===c&&!b)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(0<a?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(0<a?"right":"left")},refresh:function(a){return this._refreshItems(a),
this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(a){var b,c,d,f=[],e=[],h=this._connectWith();if(h&&a)for(a=h.length-1;0<=a;a--){c=p(h[a]);for(b=c.length-1;0<=b;b--)(d=p.data(c[b],this.widgetFullName))&&d!==this&&!d.options.disabled&&e.push([p.isFunction(d.options.items)?d.options.items.call(d.element):p(d.options.items,d.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),
d])}e.push([p.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):p(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(a=e.length-1;0<=a;a--)e[a][0].each(function(){f.push(this)});return p(f)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=p.grep(this.items,function(b){for(var c=0;a.length>c;c++)if(a[c]===b.item[0])return!1;
return!0})},_refreshItems:function(a){this.items=[];this.containers=[this];var b,c,d,f,e,h=this.items,g=[[p.isFunction(this.options.items)?this.options.items.call(this.element[0],a,{item:this.currentItem}):p(this.options.items,this.element),this]];if((e=this._connectWith())&&this.ready)for(b=e.length-1;0<=b;b--){d=p(e[b]);for(c=d.length-1;0<=c;c--)(f=p.data(d[c],this.widgetFullName))&&f!==this&&!f.options.disabled&&(g.push([p.isFunction(f.options.items)?f.options.items.call(f.element[0],a,{item:this.currentItem}):
p(f.options.items,f.element),f]),this.containers.push(f))}for(b=g.length-1;0<=b;b--){a=g[b][1];d=g[b][0];c=0;for(e=d.length;e>c;c++)f=p(d[c]),f.data(this.widgetName+"-item",a),h.push({item:f,instance:a,width:0,height:0,left:0,top:0})}},refreshPositions:function(a){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var b,c,d,f;for(b=this.items.length-1;0<=b;b--)c=this.items[b],c.instance!==this.currentContainer&&this.currentContainer&&c.item[0]!==this.currentItem[0]||(d=this.options.toleranceElement?
p(this.options.toleranceElement,c.item):c.item,a||(c.width=d.outerWidth(),c.height=d.outerHeight()),f=d.offset(),c.left=f.left,c.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(b=this.containers.length-1;0<=b;b--)f=this.containers[b].element.offset(),this.containers[b].containerCache.left=f.left,this.containers[b].containerCache.top=f.top,this.containers[b].containerCache.width=this.containers[b].element.outerWidth(),
this.containers[b].containerCache.height=this.containers[b].element.outerHeight();return this},_createPlaceholder:function(a){a=a||this;var b,c=a.options;c.placeholder&&c.placeholder.constructor!==String||(b=c.placeholder,c.placeholder={element:function(){var c=a.currentItem[0].nodeName.toLowerCase(),d=p("<"+c+">",a.document[0]).addClass(b||a.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===c?a.currentItem.children().each(function(){p("<td>&#160;</td>",
a.document[0]).attr("colspan",p(this).attr("colspan")||1).appendTo(d)}):"img"===c&&d.attr("src",a.currentItem.attr("src")),b||d.css("visibility","hidden"),d},update:function(d,f){(!b||c.forcePlaceholderSize)&&(f.height()||f.height(a.currentItem.innerHeight()-parseInt(a.currentItem.css("paddingTop")||0,10)-parseInt(a.currentItem.css("paddingBottom")||0,10)),f.width()||f.width(a.currentItem.innerWidth()-parseInt(a.currentItem.css("paddingLeft")||0,10)-parseInt(a.currentItem.css("paddingRight")||0,10)))}});
a.placeholder=p(c.placeholder.element.call(a.element,a.currentItem));a.currentItem.after(a.placeholder);c.placeholder.update(a,a.placeholder)},_contactContainers:function(a){var b,c,d,f,e,h,g,k,l,m=c=null;for(b=this.containers.length-1;0<=b;b--)if(!p.contains(this.currentItem[0],this.containers[b].element[0]))if(this._intersectsWith(this.containers[b].containerCache)){if(!c||!p.contains(this.containers[b].element[0],c.element[0]))c=this.containers[b],m=b}else this.containers[b].containerCache.over&&
(this.containers[b]._trigger("out",a,this._uiHash(this)),this.containers[b].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",a,this._uiHash(this)),this.containers[m].containerCache.over=1);else{b=1E4;d=null;f=(l=c.floating||t(this.currentItem))?"left":"top";e=l?"width":"height";h=this.positionAbs[f]+this.offset.click[f];for(c=this.items.length-1;0<=c;c--)p.contains(this.containers[m].element[0],this.items[c].item[0])&&
this.items[c].item[0]!==this.currentItem[0]&&(!l||this.positionAbs.top+this.offset.click.top>this.items[c].top&&this.items[c].top+this.items[c].height>this.positionAbs.top+this.offset.click.top)&&(g=this.items[c].item.offset()[f],k=!1,Math.abs(g-h)>Math.abs(g+this.items[c][e]-h)&&(k=!0,g+=this.items[c][e]),b>Math.abs(g-h)&&(b=Math.abs(g-h),d=this.items[c],this.direction=k?"up":"down"));if((d||this.options.dropOnEmpty)&&this.currentContainer!==this.containers[m])d?this._rearrange(a,d,null,!0):this._rearrange(a,
null,this.containers[m].element,!0),this._trigger("change",a,this._uiHash()),this.containers[m]._trigger("change",a,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",a,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(a){var b=this.options;a=p.isFunction(b.helper)?p(b.helper.apply(this.element[0],[a,this.currentItem])):"clone"===b.helper?this.currentItem.clone():
this.currentItem;return a.parents("body").length||p("parent"!==b.appendTo?b.appendTo:this.currentItem[0].parentNode)[0].appendChild(a[0]),a[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!a[0].style.width||b.forceHelperSize)&&a.width(this.currentItem.width()),(!a[0].style.height||b.forceHelperSize)&&a.height(this.currentItem.height()),
a},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" "));p.isArray(a)&&(a={left:+a[0],top:+a[1]||0});"left"in a&&(this.offset.click.left=a.left+this.margins.left);"right"in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left);"top"in a&&(this.offset.click.top=a.top+this.margins.top);"bottom"in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();
var a=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&p.contains(this.scrollParent[0],this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&p.ui.ie)&&(a={top:0,left:0}),{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),
10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions=
{width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a,b,c,d=this.options;"parent"===d.containment&&(d.containment=this.helper[0].parentNode);("document"===d.containment||"window"===d.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,p("document"===d.containment?document:window).width()-this.helperProportions.width-this.margins.left,(p("document"===d.containment?document:
window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]);/^(document|window|parent)$/.test(d.containment)||(a=p(d.containment)[0],b=p(d.containment).offset(),c="hidden"!==p(a).css("overflow"),this.containment=[b.left+(parseInt(p(a).css("borderLeftWidth"),10)||0)+(parseInt(p(a).css("paddingLeft"),10)||0)-this.margins.left,b.top+(parseInt(p(a).css("borderTopWidth"),10)||0)+(parseInt(p(a).css("paddingTop"),10)||0)-this.margins.top,b.left+(c?Math.max(a.scrollWidth,
a.offsetWidth):a.offsetWidth)-(parseInt(p(a).css("borderLeftWidth"),10)||0)-(parseInt(p(a).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,b.top+(c?Math.max(a.scrollHeight,a.offsetHeight):a.offsetHeight)-(parseInt(p(a).css("borderTopWidth"),10)||0)-(parseInt(p(a).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d="absolute"!==this.cssPosition||this.scrollParent[0]!==
document&&p.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(d[0].tagName);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:d.scrollTop())*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:d.scrollLeft())*c}},_generatePosition:function(a){var b,c,d=this.options,f=a.pageX,e=a.pageY,
h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&p.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(a.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),a.pageY-
this.offset.click.top<this.containment[1]&&(e=this.containment[1]+this.offset.click.top),a.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),a.pageY-this.offset.click.top>this.containment[3]&&(e=this.containment[3]+this.offset.click.top)),d.grid&&(b=this.originalPageY+Math.round((e-this.originalPageY)/d.grid[1])*d.grid[1],e=this.containment?b-this.offset.click.top>=this.containment[1]&&b-this.offset.click.top<=this.containment[3]?b:b-this.offset.click.top>=
this.containment[1]?b-d.grid[1]:b+d.grid[1]:b,c=this.originalPageX+Math.round((f-this.originalPageX)/d.grid[0])*d.grid[0],f=this.containment?c-this.offset.click.left>=this.containment[0]&&c-this.offset.click.left<=this.containment[2]?c:c-this.offset.click.left>=this.containment[0]?c-d.grid[0]:c+d.grid[0]:c)),{top:e-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():g?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-
this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():g?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling);var f=this.counter=this.counter?++this.counter:1;this._delay(function(){f===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){this.reverting=!1;var c,d=[];if(!this._noFinalSort&&this.currentItem.parent().length&&
this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(c in this._storedCSS)("auto"===this._storedCSS[c]||"static"===this._storedCSS[c])&&(this._storedCSS[c]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!b&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))});!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&
this.domPosition.parent===this.currentItem.parent()[0]||b||d.push(function(a){this._trigger("update",a,this._uiHash())});this!==this.currentContainer&&(b||(d.push(function(a){this._trigger("remove",a,this._uiHash())}),d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer))));for(c=this.containers.length-1;0<=c;c--)b||d.push(function(a){return function(b){a._trigger("deactivate",
b,this._uiHash(this))}}.call(this,this.containers[c])),this.containers[c].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[c])),this.containers[c].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?
"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){this._trigger("beforeStop",a,this._uiHash());for(c=0;d.length>c;c++)d[c].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(c=0;d.length>c;c++)d[c].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=
!1,!0},_trigger:function(){!1===p.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(a){var b=a||this;return{helper:b.helper,placeholder:b.placeholder||p([]),position:b.position,originalPosition:b.originalPosition,offset:b.positionAbs,item:b.currentItem,sender:a?a.element:null}}});var r=jQuery;r.widget("ui.slider",r.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,
change:null,slide:null,start:null,stop:null},_create:function(){this._mouseSliding=this._keySliding=!1;this._animateOff=!0;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all");this._refresh();this._setOption("disabled",this.options.disabled);this._animateOff=!1},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue()},_createHandles:function(){var a,
b;a=this.options;var c=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),d=[];b=a.values&&a.values.length||1;c.length>b&&(c.slice(b).remove(),c=c.slice(0,b));for(a=c.length;b>a;a++)d.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");this.handles=c.add(r(d.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.each(function(a){r(this).data("ui-slider-handle-index",a)})},_createRange:function(){var a=this.options,
b="";a.range?(!0===a.range&&(a.values?a.values.length&&2!==a.values.length?a.values=[a.values[0],a.values[0]]:r.isArray(a.values)&&(a.values=a.values.slice(0)):a.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=r("<div></div>").appendTo(this.element),b="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(b+("min"===a.range||"max"===a.range?" ui-slider-range-"+
a.range:""))):this.range=r([])},_setupEvents:function(){var a=this.handles.add(this.range).filter("a");this._off(a);this._on(a,this._handleEvents);this._hoverable(a);this._focusable(a)},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all");this._mouseDestroy()},_mouseCapture:function(a){var b,c,d,f,e,h,g,k,l=this,m=this.options;return m.disabled?!1:(this.elementSize={width:this.element.outerWidth(),
height:this.element.outerHeight()},this.elementOffset=this.element.offset(),b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b),d=this._valueMax()-this._valueMin()+1,this.handles.each(function(a){var b=Math.abs(c-l.values(a));(d>b||d===b&&(a===l._lastChangedValue||l.values(a)===m.min))&&(d=b,f=r(this),e=a)}),h=this._start(a,e),!1===h?!1:(this._mouseSliding=!0,this._handleIndex=e,f.addClass("ui-state-active").focus(),g=f.offset(),k=!r(a.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=
k?{left:0,top:0}:{left:a.pageX-g.left-f.width()/2,top:a.pageY-g.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(a,e,c),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b=this._normValueFromMouse({x:a.pageX,y:a.pageY});return this._slide(a,this._handleIndex,b),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),
this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,f,e;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-
(this._clickOffset?this._clickOffset.top:0)),d=c/b,1<d&&(d=1),0>d&&(d=0),"vertical"===this.orientation&&(d=1-d),f=this._valueMax()-this._valueMin(),e=this._valueMin()+d*f,this._trimAlignValue(e)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,f,e;this.options.values&&this.options.values.length?(d=this.values(b?0:1),
2===this.options.values.length&&!0===this.options.range&&(0===b&&c>d||1===b&&d>c)&&(c=d),c!==this.values(b)&&(f=this.values(),f[b]=c,e=this._trigger("slide",a,{handle:this.handles[b],value:c,values:f}),this.values(b?0:1),!1!==e&&this.values(b,c,!0))):c!==this.value()&&(e=this._trigger("slide",a,{handle:this.handles[b],value:c}),!1!==e&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=
this.values());this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());this._lastChangedValue=b;this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(a,b){var c,d,f;if(1<arguments.length)return this.options.values[a]=
this._trimAlignValue(b),this._refreshValue(),this._change(null,a),void 0;if(!arguments.length)return this._values();if(!r.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(a):this.value();c=this.options.values;d=arguments[0];for(f=0;c.length>f;f+=1)c[f]=this._trimAlignValue(d[f]),this._change(null,f);this._refreshValue()},_setOption:function(a,b){var c,d=0;switch("range"===a&&!0===this.options.range&&("min"===b?(this.options.value=this._values(0),this.options.values=
null):"max"===b&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),r.isArray(this.options.values)&&(d=this.options.values.length),r.Widget.prototype._setOption.apply(this,arguments),a){case "orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=!0;this._refreshValue();this._change(null,0);this._animateOff=!1;break;
case "values":this._animateOff=!0;this._refreshValue();for(c=0;d>c;c+=1)this._change(null,c);this._animateOff=!1;break;case "min":case "max":this._animateOff=!0;this._refreshValue();this._animateOff=!1;break;case "range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){return this._trimAlignValue(this.options.value)},_values:function(a){var b,c;if(arguments.length)return b=this.options.values[a],this._trimAlignValue(b);if(this.options.values&&this.options.values.length){b=
this.options.values.slice();for(c=0;b.length>c;c+=1)b[c]=this._trimAlignValue(b[c]);return b}return[]},_trimAlignValue:function(a){if(this._valueMin()>=a)return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=0<this.options.step?this.options.step:1,c=(a-this._valueMin())%b;a-=c;return 2*Math.abs(c)>=b&&(a+=0<c?b:-b),parseFloat(a.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var a,b,c,d,f,e=this.options.range,
h=this.options,g=this,k=this._animateOff?!1:h.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(c){b=100*((g.values(c)-g._valueMin())/(g._valueMax()-g._valueMin()));l["horizontal"===g.orientation?"left":"bottom"]=b+"%";r(this).stop(1,1)[k?"animate":"css"](l,h.animate);!0===g.options.range&&("horizontal"===g.orientation?(0===c&&g.range.stop(1,1)[k?"animate":"css"]({left:b+"%"},h.animate),1===c&&g.range[k?"animate":"css"]({width:b-a+"%"},{queue:!1,duration:h.animate})):
(0===c&&g.range.stop(1,1)[k?"animate":"css"]({bottom:b+"%"},h.animate),1===c&&g.range[k?"animate":"css"]({height:b-a+"%"},{queue:!1,duration:h.animate})));a=b}):(c=this.value(),d=this._valueMin(),f=this._valueMax(),b=f!==d?100*((c-d)/(f-d)):0,l["horizontal"===this.orientation?"left":"bottom"]=b+"%",this.handle.stop(1,1)[k?"animate":"css"](l,h.animate),"min"===e&&"horizontal"===this.orientation&&this.range.stop(1,1)[k?"animate":"css"]({width:b+"%"},h.animate),"max"===e&&"horizontal"===this.orientation&&
this.range[k?"animate":"css"]({width:100-b+"%"},{queue:!1,duration:h.animate}),"min"===e&&"vertical"===this.orientation&&this.range.stop(1,1)[k?"animate":"css"]({height:b+"%"},h.animate),"max"===e&&"vertical"===this.orientation&&this.range[k?"animate":"css"]({height:100-b+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(a){var b,c,d,f=r(a.target).data("ui-slider-handle-index");switch(a.keyCode){case r.ui.keyCode.HOME:case r.ui.keyCode.END:case r.ui.keyCode.PAGE_UP:case r.ui.keyCode.PAGE_DOWN:case r.ui.keyCode.UP:case r.ui.keyCode.RIGHT:case r.ui.keyCode.DOWN:case r.ui.keyCode.LEFT:if(a.preventDefault(),
!this._keySliding&&(this._keySliding=!0,r(a.target).addClass("ui-state-active"),b=this._start(a,f),!1===b))return}switch(d=this.options.step,b=c=this.options.values&&this.options.values.length?this.values(f):this.value(),a.keyCode){case r.ui.keyCode.HOME:c=this._valueMin();break;case r.ui.keyCode.END:c=this._valueMax();break;case r.ui.keyCode.PAGE_UP:c=this._trimAlignValue(b+(this._valueMax()-this._valueMin())/5);break;case r.ui.keyCode.PAGE_DOWN:c=this._trimAlignValue(b-(this._valueMax()-this._valueMin())/
5);break;case r.ui.keyCode.UP:case r.ui.keyCode.RIGHT:if(b===this._valueMax())return;c=this._trimAlignValue(b+d);break;case r.ui.keyCode.DOWN:case r.ui.keyCode.LEFT:if(b===this._valueMin())return;c=this._trimAlignValue(b-d)}this._slide(a,f,c)},click:function(a){a.preventDefault()},keyup:function(a){var b=r(a.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(a,b),this._change(a,b),r(a.target).removeClass("ui-state-active"))}}})});JCSDL.Loader.addComponent(function(e){function j(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var c=a.originalEvent.changedTouches[0],e=document.createEvent("MouseEvents");e.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(e)}}e.support.touch="ontouchend"in document;if(e.support.touch){var b=e.ui.mouse.prototype,a=b._mouseInit,c;b._touchStart=function(a){!c&&this._mouseCapture(a.originalEvent.changedTouches[0])&&
(c=!0,this._touchMoved=!1,j(a,"mouseover"),j(a,"mousemove"),j(a,"mousedown"))};b._touchMove=function(a){c&&(this._touchMoved=!0,j(a,"mousemove"))};b._touchEnd=function(a){c&&(j(a,"mouseup"),j(a,"mouseout"),this._touchMoved||j(a,"click"),c=!1)};b._mouseInit=function(){this.element.bind("touchstart",e.proxy(this,"_touchStart")).bind("touchmove",e.proxy(this,"_touchMove")).bind("touchend",e.proxy(this,"_touchEnd"));a.call(this)}}});JCSDL.Loader.addComponent(function(e){function j(a){if(a.attr("title")||"string"!=typeof a.attr("original-title"))a.attr("original-title",a.attr("title")||"").removeAttr("title")}function b(a,b){this.$element=e(a);this.options=b;this.enabled=!0;j(this.$element)}b.prototype={show:function(){var a=this.getTitle();if(a&&this.enabled){var b=this.tip();b.find(".tipsy-inner")[this.options.html?"html":"text"](a);b[0].className="tipsy";b.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);
var a=e.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),d=b[0].offsetWidth,f=b[0].offsetHeight,h="function"==typeof this.options.gravity?this.options.gravity.call(this.$element[0]):this.options.gravity,m;switch(h.charAt(0)){case "n":m={top:a.top+a.height+this.options.offset,left:a.left+a.width/2-d/2};break;case "s":m={top:a.top-f-this.options.offset,left:a.left+a.width/2-d/2};break;case "e":m={top:a.top+a.height/2-f/2,left:a.left-d-this.options.offset};
break;case "w":m={top:a.top+a.height/2-f/2,left:a.left+a.width+this.options.offset}}2==h.length&&(m.left="w"==h.charAt(1)?a.left+a.width/2-15:a.left+a.width/2-d+15);b.css(m).addClass("tipsy-"+h);this.options.fade?b.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):b.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){e(this).remove()}):this.tip().remove()},getTitle:function(){var a,
b=this.$element,d=this.options;j(b);d=this.options;"string"==typeof d.title?a=b.attr("title"==d.title?"original-title":d.title):"function"==typeof d.title&&(a=d.title.call(b[0]));return(a=(""+a).replace(/(^\s*|\s*$)/,""))||d.fallback},tip:function(){this.$tip||(this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>'));return this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.options=this.$element=null)},enable:function(){this.enabled=
!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}};e.fn.tipsy=function(a){function c(c){var d=e.data(c,"tipsy");d||(d=new b(c,e.fn.tipsy.elementOptions(c,a)),e.data(c,"tipsy",d));return d}function d(){var b=c(this);b.hoverState="in";0==a.delayIn?b.show():setTimeout(function(){"in"==b.hoverState&&b.show()},a.delayIn)}function f(){var b=c(this);b.hoverState="out";0==a.delayOut?b.hide():setTimeout(function(){"out"==b.hoverState&&b.hide()},a.delayOut)}if(!0===
a)return this.data("tipsy");if("string"==typeof a)return this.data("tipsy")[a]();a=e.extend({},e.fn.tipsy.defaults,a);a.live||this.each(function(){c(this)});if("manual"!=a.trigger){var h=a.live?"live":"bind",m="hover"==a.trigger?"mouseleave":"blur";this[h]("hover"==a.trigger?"mouseenter":"focus",d)[h](m,f)}return this};e.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:0.8,title:"title",trigger:"hover"};e.fn.tipsy.elementOptions=function(a,b){return e.metadata?
e.extend({},b,e(a).metadata()):b};e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"};e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"}});JCSDL.Loader.addComponent(function(e){e.fn.extend({simulate:function(j,b){return this.each(function(){var a=e.extend({},e.simulate.defaults,b||{});new e.simulate(this,j,a)})}});e.simulate=function(e,b,a){this.target=e;this.options=a;/^drag$/.test(b)?this[b].apply(this,[this.target,a]):this.simulateEvent(e,b,a)};e.extend(e.simulate.prototype,{simulateEvent:function(e,b,a){var c=this.createEvent(b,a);this.dispatchEvent(e,b,c,a);return c},createEvent:function(e,b){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(e))return this.mouseEvent(e,
b);if(/^key(up|down|press)$/.test(e))return this.keyboardEvent(e,b)},mouseEvent:function(j,b){var a,c=e.extend({bubbles:!0,cancelable:"mousemove"!=j,view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},b);e(c.relatedTarget);e.isFunction(document.createEvent)?(a=document.createEvent("MouseEvents"),a.initMouseEvent(j,c.bubbles,c.cancelable,c.view,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.ctrlKey,c.altKey,c.shiftKey,
c.metaKey,c.button,c.relatedTarget||document.body.parentNode)):document.createEventObject&&(a=document.createEventObject(),e.extend(a,c),a.button={"0":1,1:4,2:2}[a.button]||a.button);return a},keyboardEvent:function(j,b){var a,c=e.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0},b);if(e.isFunction(document.createEvent))try{a=document.createEvent("KeyEvents"),a.initKeyEvent(j,c.bubbles,c.cancelable,c.view,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,
c.keyCode,c.charCode)}catch(d){a=document.createEvent("Events"),a.initEvent(j,c.bubbles,c.cancelable),e.extend(a,{view:c.view,ctrlKey:c.ctrlKey,altKey:c.altKey,shiftKey:c.shiftKey,metaKey:c.metaKey,keyCode:c.keyCode,charCode:c.charCode})}else document.createEventObject&&(a=document.createEventObject(),e.extend(a,c));e("html").is(".msie")&&(a.keyCode=0<c.charCode?c.charCode:c.keyCode,a.charCode=void 0);return a},dispatchEvent:function(e,b,a){e.dispatchEvent?e.dispatchEvent(a):e.fireEvent&&e.fireEvent("on"+
b,a);return a},drag:function(){var e=this.findCenter(this.target),b=this.options,a=Math.floor(e.x),e=Math.floor(e.y),c=b.dx||0,b=b.dy||0,d=this.target,f={clientX:a,clientY:e};this.simulateEvent(d,"mousedown",f);f={clientX:a+1,clientY:e+1};this.simulateEvent(document,"mousemove",f);f={clientX:a+c,clientY:e+b};this.simulateEvent(document,"mousemove",f);this.simulateEvent(document,"mousemove",f);this.simulateEvent(d,"mouseup",f)},findCenter:function(j){j=e(this.target);var b=j.offset();return{x:b.left+
j.outerWidth()/2,y:b.top+j.outerHeight()/2}}});e.extend(e.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})});(function(e,j){JCSDL.Loader.addComponent(function(b){b.fn.zclip=function(a){if("object"==typeof a&&!a.length){var c=b.extend({path:"ZeroClipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:!0,setHandCursor:!0,setCSSEffects:!0},a);return this.each(function(){var a=b(this);if(a.is(":visible")&&("string"==typeof c.copy||b.isFunction(c.copy))){ZeroClipboard.setMoviePath(c.path);var f=new ZeroClipboard.Client;b.isFunction(c.copy)&&a.bind("zClip_copy",c.copy);b.isFunction(c.beforeCopy)&&a.bind("zClip_beforeCopy",
c.beforeCopy);b.isFunction(c.afterCopy)&&a.bind("zClip_afterCopy",c.afterCopy);f.setHandCursor(c.setHandCursor);f.setCSSEffects(c.setCSSEffects);f.addEventListener("mouseOver",function(){a.trigger("mouseenter")});f.addEventListener("mouseOut",function(){a.trigger("mouseleave")});f.addEventListener("mouseDown",function(){a.trigger("mousedown");b.isFunction(c.copy)?f.setText(a.triggerHandler("zClip_copy")):f.setText(c.copy);b.isFunction(c.beforeCopy)&&(console.log("before copy"),a.trigger("zClip_beforeCopy"))});
f.addEventListener("complete",function(f,e){b.isFunction(c.afterCopy)?a.trigger("zClip_afterCopy"):(500<e.length&&(e=e.substr(0,500)+"...\n\n("+(e.length-500)+" characters not shown)"),a.removeClass("hover"),alert("Copied text to clipboard:\n\n "+e));c.clickAfter&&a.trigger("click")});f.glue(a[0],a.parent()[0]);b(e).bind("load resize",function(){f.reposition()})}})}if("string"==typeof a)return this.each(function(){var c=b(this);a=a.toLowerCase();var f=c.data("zclipId"),f=b("#"+f+".zclip");"remove"==
a?(f.remove(),c.removeClass("active hover")):"hide"==a?(f.hide(),c.removeClass("active hover")):"show"==a&&f.show()})};e.ZeroClipboard===j&&(e.ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(a){"string"==typeof a&&(a=document.getElementById(a));a.addClass||(a.hide=function(){this.style.display="none"},a.show=function(){this.style.display=""},a.addClass=function(a){this.removeClass(a);this.className+=" "+a},a.removeClass=function(a){for(var b=this.className.split(/\s+/),
f=-1,e=0;e<b.length;e++)b[e]==a&&(f=e,e=b.length);-1<f&&(b.splice(f,1),this.className=b.join(" "));return this},a.hasClass=function(a){return!!this.className.match(RegExp("\\s*"+a+"\\s*"))});return a},setMoviePath:function(a){this.moviePath=a},dispatch:function(a,b,d){(a=this.clients[a])&&a.receiveEvent(b,d)},register:function(a,b){this.clients[a]=b},getDOMObjectPosition:function(a,b){var d={left:0,top:0,width:a.width?a.width:a.offsetWidth,height:a.height?a.height:a.offsetHeight};a&&a!=b&&(d.left+=
a.offsetLeft,d.top+=a.offsetTop);return d},Client:function(a){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId="ZeroClipboardMovie_"+this.id;ZeroClipboard.register(this.id,this);a&&this.glue(a)}},e.ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(a,c,d){this.domElement=ZeroClipboard.$(a);a=99;this.domElement.style.zIndex&&(a=parseInt(this.domElement.style.zIndex,10)+1);"string"==typeof c?c=ZeroClipboard.$(c):
"undefined"==typeof c&&(c=document.getElementsByTagName("body")[0]);var f=ZeroClipboard.getDOMObjectPosition(this.domElement,c);this.div=document.createElement("div");this.div.className="zclip";this.div.id="zclip-"+this.movieId;b(this.domElement).data("zclipId","zclip-"+this.movieId);var e=this.div.style;e.position="absolute";e.left=""+f.left+"px";e.top=""+f.top+"px";e.width=""+f.width+"px";e.height=""+f.height+"px";e.zIndex=a;if("object"==typeof d)for(addedStyle in d)e[addedStyle]=d[addedStyle];
c.appendChild(this.div);this.div.innerHTML=this.getHTML(f.width,f.height)},getHTML:function(a,b){var d="",f="id="+this.id+"&width="+a+"&height="+b;if(navigator.userAgent.match(/MSIE/))var e=location.href.match(/^https/i)?"https://":"http://",d=d+('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+a+'" height="'+b+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+
ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+f+'"/><param name="wmode" value="transparent"/></object>');else d+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+a+'" height="'+b+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+
f+'" wmode="transparent" />';return d},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML="";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div)}catch(b){}this.div=this.domElement=null}},reposition:function(a){a&&((this.domElement=ZeroClipboard.$(a))||this.hide());if(this.domElement&&this.div){a=ZeroClipboard.getDOMObjectPosition(this.domElement);var b=
this.div.style;b.left=""+a.left+"px";b.top=""+a.top+"px"}},setText:function(a){this.clipText=a;this.ready&&this.movie.setText(a)},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a;this.ready&&this.movie.setHandCursor(a)},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");switch(a){case "load":this.movie=
document.getElementById(this.movieId);if(!this.movie){var d=this;setTimeout(function(){d.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){d=this;setTimeout(function(){d.receiveEvent("load",null)},100);this.ready=!0;return}this.ready=!0;try{this.movie.setText(this.clipText)}catch(f){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(h){}break;case "mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),
this.recoverActive&&this.domElement.addClass("active"));break;case "mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case "mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case "mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[a])for(var m=
0,g=this.handlers[a].length;m<g;m++){var l=this.handlers[a][m];if("function"==typeof l)l(this,b);else if("object"==typeof l&&2==l.length)l[0][l[1]](this,b);else if("string"==typeof l)e[l](this,b)}}})})})(window);JCSDL.Loader.addComponent(function(e,j){this.Parser=function(b){this.gui=b};this.Parser.prototype={v:"2.1",parseJCSDL:function(b){var a=b.split("\n"),c=a.shift();a.pop();if(!this.verifyJCSDL(c,a))throw new JCSDL.ValidationException("The given JCSDL did not verify!",b);b=a.shift().split(" ")[2];var c=c.split(" ")[3],d=[];for("//"!==a[0].substr(0,2)&&a.shift();1<a.length;){var e=a.shift(),h=a.shift();a.shift();a.shift();var e=e.split(" "),m=e[3],g=e[4]||d.length+1;if(!this.verifyJCSDLFilter(e[2],h))throw new JCSDL.ValidationException("The given JCSDL Filter code did not verify!",
h);e=this.filterFromJCSDL(m,h,g,b);d.push(e)}return{filters:d,logic:c}},filterFromJCSDL:function(b,a,c,d){d=d||this.v;d!==this.v&&(b=this.applyFilterJCSDLTransformers(b,d));b=b.split(",");d=b.shift().split(".");var f=d.shift(),h=this.getFieldInfo(f,d);if(!1===h)return!1;var m=b.shift(),g="",l={cs:!1};"exists"!==m&&(g=b.shift().split("-"),g=this.valueFromCSDL(h,a.substr(g[0],g[1]),m),e.each(b,function(a,b){switch(b){case "cs":l.cs=!0}}));return this.createFilter(f,d,m,g,l,c)},getJCSDLForFilters:function(b,
a){var c=this,d={},f=[],h="";e.each(b,function(a,b){var e=c.filterToCSDL(b);if(!e)return!0;d[b.id+""]=e});if("AND"!=a&&"OR"!=a){var h=this.tokenizeLogicString(a),m="";this.validateLogic(h,b);e.each(h,function(a,b){if("number"===typeof b)if(m.length&&f.push(e.trim(m)),m="",d[b+""]!==j)f.push(d[b+""]);else throw new JCSDL.LogicValidationException("A filter with ID '"+b+"' doesn't exist! You cannot use it in a logical expression",a);else m="&"==b||"|"==b?m+("|"==b?" OR ":" AND "):"!"===b?m+" NOT ":m+
b});m.length&&f.push(e.trim(m));h=f.join("\n")}else e.each(d,function(a,b){f.push(b)}),h=f.join("\n"+a+"\n");h="// JCSDL_VERSION "+this.v+"\n"+h;return h="// JCSDL_MASTER "+this.encodeJCSDL(h,a)+" "+a+"\n"+h+"\n// JCSDL_MASTER_END"},filterToCSDL:function(b){var a=this.getFieldInfo(b.target,b.fieldPath);if(!1===a)return!1;var c=this.valueToCSDL(b.value,a,b.operator);if(!1===c)return!1;var d=this.fieldToCSDL(b.fieldPath);if(!1===d)return!1;var e=this.getOperatorCode(b.operator);if(!1===e)return!1;var h=
b.cs?" cs":"",e=("augmentation"==b.target?"":b.target+".")+d.replace("-",".")+h+" "+e+" ",d=b.target+"."+d+","+b.operator;"exists"!==b.operator&&(h="string"==a.type||"geo"==a.type?e.length+1:e.length,a="string"==a.type||"geo"==a.type?c.length-2:c.length,e+=c,d+=","+h+"-"+a,b.cs&&(d+=",cs"));return[["// JCSDL_START",this.encodeJCSDLFilter(e),d,b.id].join(" "),e,"// JCSDL_END"].join("\n")},encodeJCSDL:function(b,a){return Crypto.MD5(a+"\n"+b)},verifyJCSDL:function(b,a){var c=a.join("\n"),d=b.split(" "),
e=d[2],c=this.encodeJCSDL(c,d[3]);return e==c},encodeJCSDLFilter:function(b){return Crypto.MD5(b)},verifyJCSDLFilter:function(b,a){return b==this.encodeJCSDLFilter(a)},fieldToCSDL:function(b){return b.join(".")},valueToCSDL:function(b,a,c){var d="";if("int"==a.type||"float"==a.type){if("in"!==c&&isNaN(b))return this.error("This field value is suppose to be a Number, String given.",b,a),!1;"in"==c?(b=b.split(","),e.each(b,function(a,c){b[a]=parseInt(c)}),d="["+b.join(",")+"]"):d=b}else a=0<=e.inArray(c,
["regex_partial","regex_exact"])?!0:!1,d='"'+b.escapeCsdl(a)+'"';return d},valueFromCSDL:function(b,a,c){if("int"==b.type)return"in"==c&&(a=a.substr(1,a.length-2)),a;b=0<=e.inArray(c,["regex_partial","regex_exact"])?!0:!1;return a.unescapeCsdl(b)},tokenizeLogicString:function(b){b=(""+b).replace(/\s+/g,"");for(var a=[],c=!1,d=0;d<b.length;d++){var e=b.charAt(d);e.isNumeric()?(c?(a[a.length-1]+=""+e,a[a.length-1]=parseInt(a[a.length-1])):a.push(parseInt(e)),c=!0):(a.push(e),c=!1)}return a},validateLogic:function(b,
a){var c="string"===typeof b||"number"===typeof b?this.tokenizeLogicString(b):b;if(0<=e.inArray(c[0],["&","|"]))throw new JCSDL.LogicValidationException('Logical query cannot start with logical operator "'+c[0]+'"!',0);if(0<=e.inArray(c[c.length-1],["&","|","!"]))throw new JCSDL.LogicValidationException('Logical query cannot end with logical operator "'+c[c.length-1]+'"!',c.length-1);var d=null,f=[],h=0,m=[];a&&a.length&&e.each(a,function(a,b){m.push(parseInt(b.id))});e.each(c,function(a,b){if("("==
b&&")"==d)throw new JCSDL.LogicValidationException('You cannot use opening parenthesis "(" right after a closing parenthesis ")"!',a);if(")"==b&&"("==d)throw new JCSDL.LogicValidationException('You cannot use closing parenthesis ")" right after an opening parenthesis "("!',a);if(")"==b&&0<=e.inArray(d,["&","|","!"]))throw new JCSDL.LogicValidationException('You cannot use closing parenthesis ")" right after a logical operator!',a);if(0<=e.inArray(b,["&","|"])&&"("==d)throw new JCSDL.LogicValidationException('You cannot use logical operator "'+
b+'" ("'+("&"===b?"AND":"OR")+") right after opening brackets!",a);if("("==b&&"number"==typeof d)throw new JCSDL.LogicValidationException('You cannot open a parenthesis right after filter ID! You need to use a logical operator "&" ("AND") or "|" ("OR")!',a);if("number"==typeof b&&")"==d)throw new JCSDL.LogicValidationException('You cannot use filter ID right after closing a parenthesis! You need to use a logical operator "&" ("AND") or "|" ("OR")!',a);if(0<=e.inArray(b,["&","|"])&&0<=e.inArray(d,
["&","|"]))throw new JCSDL.LogicValidationException("You cannot use two logical operators next to each other!",a);if(0<=e.inArray(b,["&","|"])&&"!"===d)throw new JCSDL.LogicValidationException('You cannot use logical operator "!" ("NOT") in front of other logical operators!',a-1);if("!"===b&&"!"===d)throw new JCSDL.LogicValidationException('You cannot use two logical operators "!" ("NOT") right after each other!',a);if("number"==typeof b){if("number"==typeof d)throw new JCSDL.LogicValidationException("Cannot use two filter ID's next to each other!",
a);if(-1==e.inArray(b,m))throw new JCSDL.LogicValidationException('The filter ID "'+b+"\" doesn't exist! You can only use filters from the list of filters.",a);if(0<=e.inArray(b,f))throw new JCSDL.LogicValidationException('The filter with ID "'+b+'" has already been used in the logical expression! You can only use one filter once.',a);f.push(b)}if(0<=e.inArray(b,["(",")"])&&(h="("==b?h+1:h-1,0>h))throw new JCSDL.LogicValidationException("Parentheses do not create a logical expression, i.e. there are too many closing parenthesis that close a nested expression that was never opened!",
a);d=b});var g=[];e.each(m,function(a,b){-1==e.inArray(b,f)&&g.push(b)});if(g.length)throw new JCSDL.LogicValidationException("You haven't used some of the filters in your logical expression (with ID's: \""+g.join('", "')+'"). All filters need to be used!');if(0!==h)throw new JCSDL.LogicValidationException("You have't closed some parentheses!");return!0},error:function(b,a){this.gui.showError.apply(this.gui,arguments)},createFilter:function(b,a,c,d,e,h){e=e||{};return{id:h,target:b,fieldPath:a,operator:c,
value:d,cs:e.cs}},getOperatorCode:function(b){return this.gui.definition.operators[b].code},getTargetInfo:function(b){if(this.gui.definition.targets[b]!==j)return this.gui.definition.targets[b];this.error("Such target does not exist!",b);return!1},getFieldInfo:function(b,a){var c=this,d=this.gui.definition.targets[b];if(d===j)return this.error("Such target does not exist!",b),!1;e.each(a,function(e,h){if(d.fields!==j)if(d.fields[h]!==j)d=d.fields[h];else return c.error("Invalid path to a field (#1)!",
b,a,d),d=!1;else return c.error("Invalid path to a field (#2)!",b,a,d),d=!1});return d},transformers:[{from:"1.0",to:"2.0",filter:function(b){b=b.split(",");"augmentation.language-tag"===b[0]&&(b[0]="augmentation.language.tag");return b.join(",")}}],applyFilterJCSDLTransformers:function(b,a){var c=!1,d=b;e.each(this.transformers,function(e,h){if(c||h.from===a)c=!0,"function"===typeof h.filter&&(d=h.filter(b))});return d}};this.ValidationException=function(b,a){this.message=b;this.code=a};this.LogicValidationException=
function(b,a){this.message=b;this.index=a}});JCSDL.Loader.addComponent(function(e){this.GUITemplates={container:e('<div class="jcsdl-container" />'),editor:e('<div class="jcsdl-mainview"><div class="jcsdl-header"><div class="jcsdl-row"><h3>Filters</h3><div class="jcsdl-actions"><a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-cancel">Cancel</a><a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-save">Save and Preview</a></div></div><div class="jcsdl-advanced-container jcsdl-bordered" style="display: none;"><div class="jcsdl-advanced-gui-container"><ul class="jcsdl-advanced-gui" /><a href="#" class="jcsdl-advanced-gui-arrow left off"><span class="jcsdl-elements-sprite" /></a><a href="#" class="jcsdl-advanced-gui-arrow right off"><span class="jcsdl-elements-sprite" /></a></div><div class="jcsdl-advanced-manual" style="display: none;"><input type="text" name="advanced" placeholder="1&(2|3)..." /></div></div><div class="jcsdl-row"><div class="jcsdl-filters-logic"><a href="#" class="jcsdl-btn jcsdl-filters-logic-option jcsdl-and active disabled" data-logic="AND" data-text-long="ALL of the following" data-text-short="ALL">ALL of the following</a><a href="#" class="jcsdl-btn jcsdl-filters-logic-option jcsdl-or disabled" data-logic="OR" data-text-long="ANY of the following" data-text-short="ANY">ANY of the following</a><a href="#" class="jcsdl-btn jcsdl-filters-logic-option jcsdl-advanced disabled" data-logic="ADVANCED">ADVANCED<span class="jcsdl-logic-help" data-text-general="Use the advanced option to create logical expressions." data-text-gui="Drag and drop the tiles to create an advanced query." data-text-manual="Type a logical expression to create an advanced query.">?</span></a><a href="#" class="jcsdl-btn jcsdl-filters-logic-option jcsdl-advanced-option jcsdl-advanced-add-brackets">+ [ ]</a><a href="#" class="jcsdl-btn jcsdl-filters-logic-option jcsdl-advanced-option jcsdl-advanced-add-not">+ NOT</a><a href="#" class="jcsdl-btn jcsdl-filters-logic-option jcsdl-advanced-option jcsdl-advanced-manual-edit" data-text-gui="Manual Edit" data-text-manual="Graphical Edit">Manual Edit</a></div><div class="jcsdl-mainview-actions"><a href="#" class="jcsdl-btn jcsdl-mainview-action jcsdl-editor-preview"><div class="jcsdl-picto jcsdl-elements-sprite"></div></a><a href="#" class="jcsdl-btn jcsdl-mainview-action jcsdl-add-filter"><div class="jcsdl-picto jcsdl-elements-sprite"></div>Create New Filter</a></div><div class="jcsdl-mainview-mode"><div class="jcsdl-label">View as:</div><div class="jcsdl-bordered jcsdl-mainview-mode-options"><a href="#" class="jcsdl-mainview-mode-option jcsdl-elements-sprite jcsdl-expanded active" data-mode="expanded"></a><a href="#" class="jcsdl-mainview-mode-option jcsdl-elements-sprite jcsdl-collapsed" data-mode="collapsed"></a></div></div></div></div><div class="jcsdl-filters-list expanded" /><div class="jcsdl-footer"><div class="jcsdl-actions"><a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-save">Save and Preview</a><a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-cancel">Cancel</a></div><div class="jcsdl-mainview-actions"><a href="#" class="jcsdl-btn jcsdl-mainview-action jcsdl-add-filter"><div class="jcsdl-picto jcsdl-elements-sprite"></div>Create New Filter</a></div></div></div>'),
filter:e('<div class="jcsdl-filter"><div class="jcsdl-filter-description"><div class="jcsdl-filter-info jcsdl-bordered id" /><div class="jcsdl-filter-info target" /><div class="jcsdl-filter-info field" /><div class="jcsdl-filter-info operator" /><div class="jcsdl-filter-info jcsdl-bordered value" /></div><div class="jcsdl-filter-options"><a href="#" class="edit">Edit</a><span>/</span><a href="#" class="delete">Delete</a></div></div>'),filterTarget:e('<div class="jcsdl-filter-target jcsdl-icon target" />'),
filterField:e('<div class="jcsdl-filter-field jcsdl-icon field" />'),filterFieldInput:e('<div class="jcsdl-filter-info input"><div class="jcsdl-filter-field-input jcsdl-icon input" /></div>'),filterOperator:e('<div class="jcsdl-filter-operator jcsdl-icon operator" />'),filterValue:e('<div class="jcsdl-filter-value" />'),error:e('<div class="jcsdl-error jcsdl-elements-sprite"><strong>Error:</strong><span /></div>'),logicToken_operatorAnd:e('<div href="#" class="jcsdl-logic-token operator" data-token="&">AND</div>'),
logicToken_operatorOr:e('<div href="#" class="jcsdl-logic-token operator" data-token="|">OR</div>'),logicToken_operatorNot:e('<div href="#" class="jcsdl-logic-token operator" data-token="!">NOT<a href="#" class="jcsdl-delete-token"><span class="jcsdl-elements-sprite" /></a></div>'),logicToken_bracketOpen:e('<div href="#" class="jcsdl-logic-token bracket" data-token="(">[<a href="#" class="jcsdl-delete-token"><span class="jcsdl-elements-sprite" /></a></div>'),logicToken_bracketClose:e('<div href="#" class="jcsdl-logic-token bracket" data-token=")">]<a href="#" class="jcsdl-delete-token"><span class="jcsdl-elements-sprite" /></a></div>'),
logicToken_filter:e('<div href="#" class="jcsdl-logic-token filter" data-token="#">#</div>'),filterEditor:e('<div class="jcsdl-filter-editor"><div class="jcsdl-steps"></div><div class="jcsdl-footer"><a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-filter-save">Save and Preview</a><span style="display: none;">or</span> <a href="#" class="jcsdl-filter-cancel">cancel</a></div></div>'),step:e('<div class="jcsdl-step" />'),target:e('<div class="jcsdl-filter-target-wrap"><a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite left"></a><a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite right"></a><div class="jcsdl-carousel-wrap"><div class="jcsdl-filter-target jcsdl-carousel" /></div></div>'),
targetOption:e('<a href="#" class="jcsdl-icon target jcsdl-carousel-item"></a>'),field:e('<div class="jcsdl-filter-target-field-wrap"><a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite left"></a><a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite right"></a><div class="jcsdl-carousel-wrap"><div class="jcsdl-filter-target-field jcsdl-carousel" /></div></div>'),fieldOption:e('<a href="#" class="jcsdl-icon field jcsdl-carousel-item" />'),inputSelect:e('<div class="jcsdl-filter-target-field-input-wrap"><a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite left"></a><a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite right"></a><div class="jcsdl-carousel-wrap"><div class="jcsdl-filter-target-field-input jcsdl-carousel" /></div></div>'),
inputSelectOption:e('<a href="#" class="jcsdl-icon input jcsdl-carousel-item" />'),targetHelp:e('<a href="#" class="jcsdl-target-help">Learn More</a>'),valueInput:e('<div class="jcsdl-filter-value-input"><div class="jcsdl-filter-value-input-operators" /><div class="jcsdl-filter-value-input-field" /></div>'),operatorOption:e('<a href="#" class="jcsdl-icon operator" />'),textOperatorsSelect:e('<div class="jcsdl-operators-select"><div class="jcsdl-operator-label" /><div class="jcsdl-dropdown-icon jcsdl-elements-sprite" /></div>'),
textOperatorsDropdown:e('<div class="jcsdl-dropdown jcsdl-operators-dropdown" />'),textOperatorOption:e('<div class="jcsdl-dropdown-option"><div class="jcsdl-icon operator" /><a href="#" class="jcsdl-dropdown-details-trigger jcsdl-elements-sprite">?</a><div class="jcsdl-dropdown-option-desc"><div class="jcsdl-operator-label"><span /> <a href="#" class="jcsdl-operator-help">(?)</a></div><div class="jcsdl-operator-desc" /></div></div>'),caseSensitivity:e('<a class="jcsdl-operator-cs jcsdl-icon icon-cs operator" title="Case Sensitive" />'),
valueInput_text:e('<div class="jcsdl-input-text"><input type="text" placeholder="Type your desired value..." class="orig" /><div class="jcsdl-containsnear-distance"><span>Distance:</span><input type="text" placeholder="e.g. 0" value="2" class="dist" /></div></div>'),valueInput_number:e('<div class="jcsdl-input-number"><input type="text" placeholder="e.g. 3.14" /></div>'),valueInput_select:e('<div class="jcsdl-input-select" />'),valueInput_select_option:e('<a href="#" class="jcsdl-btn jcsdl-input-select-option"><span /></a>'),
valueInput_select_more:e('<span class="jcsdl-input-select-more">and <span class="count"></span> more...</span>'),valueInput_slider:e('<div class="jcsdl-input-slider"><div class="jcsdl-slider-controls"><a href="#" class="jcsdl-slider-minus jcsdl-elements-sprite" /><a href="#" class="jcsdl-slider-plus jcsdl-elements-sprite" /><input type="text" name="value" class="jcsdl-slider-input" placeholder="0" /></div><div class="jcsdl-slider-wrap"><div class="jcsdl-slider-icon min" /><div class="jcsdl-slider-icon max" /><div class="jcsdl-slider-container"><div class="jcsdl-slider-label min" /><div class="jcsdl-slider-label max" /><div class="jcsdl-slider jcsdl-elements-sprite" /><div class="jcsdl-slider-bottom"><div class="jcsdl-slider-bottom-left jcsdl-elements-sprite" /><div class="jcsdl-slider-bottom-right jcsdl-elements-sprite" /><div class="jcsdl-slider-bottom-line jcsdl-elements-sprite" /></div></div></div></div>'),
valueInput_geo_map:e('<div class="jcsdl-map"><input type="text" name="location" class="jcsdl-map-search" placeholder="Search for location..." /><div class="jcsdl-map-canvas" /><a href="#" class="jcsdl-clear-map">clear coordinates</a><p class="jcsdl-map-instructions" /><div class="jcsdl-map-coordinates" /><div class="jcsdl-map-area"><label>Area:</label><span>0 km<sup>2</sup></span></div></div>'),valueInput_geobox:e('<div class="jcsdl-input-geo jcsdl-geo-box" />'),valueInput_geobox_coordinates:e('<ul><li class="nw"><label>NW:</label><span /></li><li class="ne"><label>NE:</label><span /></li><li class="se"><label>SE:</label><span /></li><li class="sw"><label>SW:</label><span /></li></ul>'),
valueInput_georadius:e('<div class="jcsdl-input-geo jcsdl-geo-radius" />'),valueInput_georadius_coordinates:e('<ul><li class="center"><label>Center:</label><span /></li><li class="radius"><label>Radius:</label><span /></li></ul>'),valueInput_geopolygon:e('<div class="jcsdl-input-geo jcsdl-geo-polygon" />'),valueInput_geopolygon_coordinates:e("<ul />")}});JCSDL.Loader.addComponent(function(e,j){this.GUIInputs=function(b){this.gui=b;this.definition=b.definition;this.getTemplate=b.getTemplate};this.GUIInputs.prototype={exec:function(b,a,c){return this[b][a].apply(this,c)},text:{init:function(){var b=this.getTemplate("valueInput_text"),a=b.find("input.orig");a.jcsdlTagInput();a.jcsdlRegExTester();b.find("input.dist").jcsdlNumberMask();return b},setValue:function(b,a,c,d){"contains_near"==d&&(c=c.split(":"),a=parseInt(c.pop()),b.find("input.dist").val(a),
c=c.join(":").replace(/\\:/g,":"));b.find("input.orig").val(c)},getValue:function(b,a,c){a=b.find("input.orig").val();"contains_near"==c&&(a=a.replace(/:/g,"\\:")+":"+parseInt(b.find("input.dist").val()));return a},displayValue:function(b,a,c){return"contains_near"==c.operator?(a=a.split(":"),b=parseInt(a.pop()),a=a.join(":").truncate(50,"...",!0).escapeHtml(),a+" : "+b):a.truncate(50,"...",!0).escapeHtml()}},number:{init:function(b){var a=this.getTemplate("valueInput_number"),c="float"==b.type;b=
0<=e.inArray("in",b.operators);var d=a.find("input[type=text]");d.jcsdlNumberMask(c);b&&d.jcsdlTagInput({numbers:!0,floats:c});return a},setValue:function(b,a,c){b.find("input[type=text]:first").val(c)},getValue:function(b){return b.find("input[type=text]:first").val()},displayValue:function(b,a,c){if("in"!==c.operator)return a;var d="float"==b.type;a=a.split(",");var f=a.slice(0,3);e.each(f,function(a,b){f[a]=d?parseFloat(b).format(2):b});b=f.length<a.length?" and "+(a.length-f.length)+" more...":
"";return f.join(", ")+b}},select:{init:function(b){var a=this,c=this.getTemplate("valueInput_select"),d=this.exec("select","getOptionsSet",[b]);e.each(d,function(b,d){a.exec("select","createOptionView",[b,d]).appendTo(c)});c.find(".jcsdl-input-select-option").bind("click touchstart",function(a){a.preventDefault();a.target.blur();b.single&&c.find(".jcsdl-input-select-option").removeClass("selected");e(this).toggleClass("selected")});return c},setValue:function(b,a,c){a=c.split(",");e.each(a,function(a,
c){b.find(".jcsdl-input-select-option.option-"+c).addClass("selected")})},getValue:function(b){var a=[];b.find(".jcsdl-input-select-option.selected").each(function(b,d){a.push(e(d).data("value"))});return a.join(",")},displayValue:function(b,a){var c=this,d=a.split(","),f=this.getTemplate("valueInput_select");if(0==d.length)return f;var h=this.exec("select","getOptionsSet",[b]),m=d.slice(0,5);e.each(m,function(a,b){if(h[b]===j)return!0;c.exec("select","createOptionView",[b,h[b]]).addClass("selected").appendTo(f)});
if(d.length>m.length){var g=this.getTemplate("valueInput_select_more");g.find(".count").html(d.length-m.length);g.appendTo(f)}f.find(".jcsdl-input-select-option").bind("click touchstart",function(a){a.preventDefault();a.target.blur()});return f},getOptionsSet:function(b){var a={};b.options!==j?a=b.options:b.optionsSet!==j&&this.definition.inputs.select.sets[b.optionsSet]!==j&&(a=this.definition.inputs.select.sets[b.optionsSet]);return a},createOptionView:function(b,a){var c=this.getTemplate("valueInput_select_option").data("value",
b).addClass("option-"+b).attr("title",a);c.find("span").html(a);return c}},slider:{init:function(b){var a=this,c=this.getTemplate("valueInput_slider"),d=this.exec("slider","getOptions",[b]);c.find(".jcsdl-slider").slider({animate:!0,min:d.min,max:d.max,step:d.step,value:d["default"],slide:function(d,e){c.find(".jcsdl-slider-input").val(a.exec("slider","parseValue",[b,e.value]))}});this.exec("slider","setValue",[c,b,d["default"]]);c.find(".jcsdl-slider-label.min").html(this.exec("slider","displayValue",
[b,d.min]));c.find(".jcsdl-slider-label.max").html(this.exec("slider","displayValue",[b,d.max]));c.find(".jcsdl-slider-input").jcsdlNumberMask("float"==b.type).keyup(function(d){110==d.which||190==d.which||(d=e(this).val(),a.exec("slider","setValue",[c,b,parseFloat(d?d:0)]))});var f=null;c.find(".jcsdl-slider-minus, .jcsdl-slider-plus").bind("mousedown touchstart",function(){var h=e(this).is(".jcsdl-slider-minus");f=setInterval(function(){var e=d.step,f=parseFloat(c.find(".jcsdl-slider-input").val()),
f=h?f-e:f+e;a.exec("slider","setValue",[c,b,f])},50)}).bind("mouseup mouseout touchend",function(){clearInterval(f)}).click(function(a){a.preventDefault();a.target.blur()});return c},setValue:function(b,a,c){a=this.exec("slider","getOptions",[a]);c=c>a.max?a.max:c<a.min?a.min:c;b.find(".jcsdl-slider").slider("value",c);b.find(".jcsdl-slider-input").val(c)},getValue:function(b,a){return this.exec("slider","parseValue",[a,b.find(".jcsdl-slider-input").val()])},displayValue:function(b,a){var c=this.exec("slider",
"getOptions",[b]);return c.displayFormat.apply(c,[a.toString()])},parseValue:function(b,a){return a},getOptions:function(b){return e.extend({},this.definition.inputs.slider,{min:b.min,max:b.max,step:b.step,"default":b["default"],displayFormat:b.displayFormat})}},_geo:{mapOptions:{},initSearch:function(b){var a=b.data("map"),c=b.find(".jcsdl-map-search"),d=new google.maps.places.Autocomplete(c[0],{});google.maps.event.addListener(d,"place_changed",function(){var b=d.getPlace();b.geometry===j?0<e(".pac-container .pac-item").length&&
(c.trigger("focus"),c.simulate("keydown",{keyCode:40}),c.simulate("keydown",{keyCode:13})):b.geometry.viewport?a.fitBounds(b.geometry.viewport):(a.setCenter(b.geometry.location),a.setZoom(17))})},isNorth:function(b,a){return b.lat()>=a.lat()},isEast:function(b,a){return b.lng()>=a.lng()}},geo_box:{init:function(b){var a=this.getTemplate("valueInput_geobox");a.append(this.getTemplate("valueInput_geo_map"));a.find(".jcsdl-map-coordinates").html(this.getTemplate("valueInput_geobox_coordinates"));a.find(".jcsdl-map-instructions").html(this.definition.inputs.geo_box.instructions[0]);
loadGoogleMapsApi(this.gui,this.exec,["geo_box","load",[b,a]]);return a},load:function(b,a){var c=this,d=new google.maps.Map(a.find(".jcsdl-map-canvas")[0],jcsdlMapsOptions);a.data("map",d);var f=new google.maps.Rectangle(e.extend({},this.gui.config.mapsOverlay,{}));a.data("rect",f);var h=[],m={position:new google.maps.LatLng(0,0),draggable:!0,icon:this.gui.config.mapsMarker},g=[new google.maps.Marker(m),new google.maps.Marker(m)];a.data("markers",g);this._geo.initSearch(a);google.maps.event.addListener(d,
"click",function(b){2<=h.length&&h.pop();h.push(b.latLng);var e=h.length-1;g[e].setPosition(b.latLng);a.data("bothMarkersVisible")||g[e].setAnimation(google.maps.Animation.DROP);g[e].setMap(d);2==h.length&&(c.exec("geo_box","drawRectangle",[d,f,h]),a.data("bothMarkersVisible",!0));a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_box.instructions[h.length]);a.find(".jcsdl-clear-map").fadeIn()});google.maps.event.addListener(g[0],"position_changed",function(){h[0]=this.getPosition();c.exec("geo_box",
"drawRectangle",[d,f,h]);2==h.length&&c.exec("geo_box","updateInfo",[a,f])});google.maps.event.addListener(g[1],"position_changed",function(){h[1]=this.getPosition();c.exec("geo_box","drawRectangle",[d,f,h]);c.exec("geo_box","updateInfo",[a,f])});a.find(".jcsdl-clear-map").bind("click touchstart",function(b){b.preventDefault();b.target.blur();h=[];f.setMap(null);g[0].setMap(null);g[1].setMap(null);a.data("bothMarkersVisible",!1);a.find(".jcsdl-map-area span").html("0 km<sup>2</sup>");a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_box.instructions[0]);
e(this).hide()})},setValue:function(b,a,c){var d=this,e=b.find(".jcsdl-input-geo");c=c.split(":");var h=c[0].split(","),m=c[1].split(",");setTimeout(function(){var a=e.data("map"),c=e.data("rect"),k=d.exec("geo_box","getAllTipsFromNWSE",[h,m]),j=new google.maps.LatLngBounds(k.sw,k.ne);d.exec("geo_box","drawRectangleFromBounds",[a,c,j]);j=e.data("markers");j[0].setMap(a);j[0].setPosition(k.ne);j[1].setMap(a);j[1].setPosition(k.sw);a.fitBounds(c.getBounds());d.exec("geo_box","updateInfo",[e,c]);b.find(".jcsdl-map-instructions").html(d.definition.inputs.geo_box.instructions[2]);
b.find(".jcsdl-clear-map").fadeIn()},this.gui.config.animate+200)},getValue:function(b){b=b.find(".jcsdl-input-geo").data("rect");if(!b.getMap())return"";b=this.exec("geo_box","getAllTipsFromBounds",[b.getBounds()]);return b.nw.lat()+","+b.nw.lng()+":"+b.se.lat()+","+b.se.lng()},displayValue:function(b,a){a=a.split(":");var c=a[0].split(","),d=a[1].split(",");return parseFloat(c[0]).format(2)+", "+parseFloat(c[1]).format(2)+" : "+parseFloat(d[0]).format(2)+", "+parseFloat(d[1]).format(2)},drawRectangle:function(b,
a,c){if(2!=c.length)return!1;c=this.exec("geo_box","getAllTipsFromUnspecified",[c[0],c[1]]);c=new google.maps.LatLngBounds(c.sw,c.ne);this.exec("geo_box","drawRectangleFromBounds",[b,a,c]);return!0},drawRectangleFromBounds:function(b,a,c){a.setBounds(c);a.setMap(b)},getAllTipsFromBounds:function(b){var a={};a.ne=b.getNorthEast();a.sw=b.getSouthWest();a.nw=new google.maps.LatLng(a.ne.lat(),a.sw.lng());a.se=new google.maps.LatLng(a.sw.lat(),a.ne.lng());return a},getAllTipsFromNWSE:function(b,a){var c=
{};c.nw=new google.maps.LatLng(parseFloat(b[0]),parseFloat(b[1]));c.se=new google.maps.LatLng(parseFloat(a[0]),parseFloat(a[1]));c.ne=new google.maps.LatLng(c.nw.lat(),c.se.lng());c.sw=new google.maps.LatLng(c.se.lat(),c.nw.lng());return c},getAllTipsFromUnspecified:function(b,a){var c={},d,e,h;this._geo.isNorth(b,a)?(c=b,d=a):(c=a,d=b);this._geo.isEast(b,a)?(h=b,e=a):(h=a,e=b);return c={nw:new google.maps.LatLng(c.lat(),e.lng()),ne:new google.maps.LatLng(c.lat(),h.lng()),se:new google.maps.LatLng(d.lat(),
h.lng()),sw:new google.maps.LatLng(d.lat(),e.lng())}},updateInfo:function(b,a){var c=this.exec("geo_box","getAllTipsFromBounds",[a.getBounds()]),d=google.maps.geometry.spherical.computeArea([c.nw,c.ne,c.se,c.sw]);b.find(".jcsdl-map-area span").html(Math.round(d/1E6).format()+" km<sup>2</sup>");e.each(c,function(a,c){b.find(".jcsdl-map-coordinates ."+a+" span").html(c.lat().format(2)+", "+c.lng().format(2))})}},geo_radius:{init:function(b){var a=this.getTemplate("valueInput_georadius");a.append(this.getTemplate("valueInput_geo_map"));
a.find(".jcsdl-map-coordinates").html(this.getTemplate("valueInput_georadius_coordinates"));a.find(".jcsdl-map-instructions").html(this.definition.inputs.geo_radius.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,["geo_radius","load",[b,a]]);return a},load:function(b,a){var c=this,d=new google.maps.Map(a.find(".jcsdl-map-canvas")[0],jcsdlMapsOptions);a.data("map",d);var f=e.extend({},this.gui.config.mapsOverlay,{}),h=new google.maps.Circle(f);a.data("circle",h);var f={position:new google.maps.LatLng(0,
0),draggable:!0,icon:this.gui.config.mapsMarker},m=new google.maps.Marker(f);a.data("centerMarker",m);var g=new google.maps.Marker(f);a.data("radiusMarker",g);a.data("center",!1);this._geo.initSearch(a);google.maps.event.addListener(d,"click",function(b){if(a.data("center")){var e=google.maps.geometry.spherical.computeDistanceBetween(h.getCenter(),b.latLng);h.setRadius(e);h.setMap(d);g.setPosition(b.latLng);g.setMap(d);c.exec("geo_radius","updateInfo",[a,h]);a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_radius.instructions[2])}else h.setCenter(b.latLng),
m.setPosition(b.latLng),m.setMap(d),a.data("center",!0),a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_radius.instructions[1]);a.find(".jcsdl-clear-map").fadeIn()});google.maps.event.addListener(m,"position_changed",function(){var a=this.getPosition(),b=h.getCenter();h.setCenter(a);if(b!==j){var c=a.lat()-b.lat(),a=a.lng()-b.lng(),b=g.getPosition(),c=new google.maps.LatLng(b.lat()+c,b.lng()+a);g.setPosition(c)}});google.maps.event.addListener(g,"position_changed",function(){h.getCenter()!==
j&&(h.setRadius(google.maps.geometry.spherical.computeDistanceBetween(h.getCenter(),this.getPosition())),c.exec("geo_radius","updateInfo",[a,h]))});a.find(".jcsdl-clear-map").bind("click touchstart",function(b){b.preventDefault();b.target.blur();h.setCenter(null);h.setMap(null);m.setMap(null);g.setMap(null);a.data("center",!1);a.find(".jcsdl-map-area span").html("0 km<sup>2</sup>");a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_radius.instructions[0]);e(this).hide()})},setValue:function(b,
a,c){var d=this,e=b.find(".jcsdl-input-geo");c=c.split(":");var h=c[0].split(","),m=1E3*parseFloat(c[1]);setTimeout(function(){var a=e.data("map"),c=e.data("circle"),k=new google.maps.LatLng(h[0],h[1]),j=e.data("centerMarker");j.setPosition(k);j.setMap(a);var j=e.data("radiusMarker"),n=google.maps.geometry.spherical.computeOffset(k,m,90);j.setPosition(n);j.setMap(a);c.setCenter(k);c.setRadius(m);c.setMap(a);e.data("center",!0);a.fitBounds(c.getBounds());d.exec("geo_radius","updateInfo",[e,c]);b.find(".jcsdl-map-instructions").html(d.definition.inputs.geo_radius.instructions[2]);
b.find(".jcsdl-clear-map").fadeIn()},this.gui.config.animate+200)},getValue:function(b){b=b.find(".jcsdl-input-geo").data("circle");if(!b.getMap())return"";var a=b.getCenter();return a.lat()+","+a.lng()+":"+b.getRadius()/1E3},displayValue:function(b,a){a=a.split(":");var c=a[0].split(","),d=a[1];return"Center: "+parseFloat(c[0]).format(2)+", "+parseFloat(c[1]).format(2)+"; Radius: "+parseFloat(d).format(2)+" km"},updateInfo:function(b,a){var c=a.getRadius(),c=c*c*Math.PI;b.find(".jcsdl-map-area span").html(Math.round(c/
1E6).format()+" km<sup>2</sup>");c=a.getCenter();b.find(".jcsdl-map-coordinates .center span").html(c.lat().format(2)+", "+c.lng().format(2));b.find(".jcsdl-map-coordinates .radius span").html((a.getRadius()/1E3).format(2)+" km")}},geo_polygon:{init:function(b){var a=this.getTemplate("valueInput_geopolygon");a.append(this.getTemplate("valueInput_geo_map"));a.find(".jcsdl-map-coordinates").html(this.getTemplate("valueInput_geopolygon_coordinates"));a.find(".jcsdl-map-instructions").html(this.definition.inputs.geo_polygon.instructions[0]);
loadGoogleMapsApi(this.gui,this.exec,["geo_polygon","load",[b,a]]);return a},load:function(b,a){var c=this,d=new google.maps.Map(a.find(".jcsdl-map-canvas")[0],jcsdlMapsOptions);a.data("map",d);var f=e.extend({},this.gui.config.mapsOverlay,{paths:[[]],editable:!0}),h=new google.maps.Polygon(f),m=h.getPath();a.data("polygon",h);var g=new google.maps.MVCArray;a.data("markers",g);var l=1;this._geo.initSearch(a);google.maps.event.addListener(d,"click",function(a){m.push(a.latLng)});google.maps.event.addListener(m,
"insert_at",function(b){var e=new google.maps.Marker({map:d,position:m.getAt(b),draggable:!0,icon:c.gui.config.mapsMarker,zIndex:l++});g.insertAt(b,e);3<=m.getLength()&&h.setMap(d);b=3>=m.getLength()?m.getLength():3;a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_polygon.instructions[b]);c.exec("geo_polygon","updateInfo",[a,h]);a.find(".jcsdl-clear-map").fadeIn();google.maps.event.addListener(e,"position_changed",function(){var b=c.exec("geo_polygon","getMarkerIndex",[e,g]);-1!=b&&
(m.setAt(b,this.getPosition()),c.exec("geo_polygon","updateInfo",[a,h]))});google.maps.event.addListener(e,"dblclick",function(){var b=c.exec("geo_polygon","getMarkerIndex",[e,g]);-1!=b&&(m.removeAt(b),g.removeAt(b),this.setMap(null),c.exec("geo_polygon","updateInfo",[a,h]))})});google.maps.event.addListener(m,"set_at",function(a){var b=g.getAt(a);a=m.getAt(a);b.getPosition().equals(a)||b.setPosition(a)});a.find(".jcsdl-clear-map").bind("click touchstart",function(b){b.preventDefault();b.target.blur();
g.forEach(function(a){a.setMap(null)});g.clear();m.clear();c.exec("geo_polygon","updateInfo",[a,h]);a.find(".jcsdl-map-instructions").html(c.definition.inputs.geo_polygon.instructions[0]);e(this).hide()})},setValue:function(b,a,c){var d=this,f=b.find(".jcsdl-input-geo");c=c.split(":");setTimeout(function(){var a=f.data("polygon"),m=f.data("map");e.each(c,function(b,c){c=c.split(",");var d=new google.maps.LatLng(parseFloat(c[0]),parseFloat(c[1]));a.getPath().push(d)});m.fitBounds(a.getBounds());d.exec("geo_polygon",
"updateInfo",[f,a]);b.find(".jcsdl-map-instructions").html(d.definition.inputs.geo_polygon.instructions[3]);b.find(".jcsdl-clear-map").fadeIn()},this.gui.config.animate+200)},getValue:function(b){var a=[];b.find(".jcsdl-input-geo").data("polygon").getPath().forEach(function(b){a.push(b.lat()+","+b.lng())});return a.join(":")},displayValue:function(b,a){a=a.split(":");var c=[];e.each(a,function(a,b){b=b.split(",");c.push(parseFloat(b[0]).format(2)+", "+parseFloat(b[1]).format(2));if(1==a)return!1});
c=c.join(" : ");2<a.length&&(c+=" and "+(a.length-2)+" more...");return c},getMarkerIndex:function(b,a){var c=-1;a.forEach(function(a,e){a.getZIndex()==b.getZIndex()&&(c=e)});return c},updateInfo:function(b,a){var c=a.getPath(),d=b.find(".jcsdl-map-coordinates ul").html("");c.forEach(function(a){e("<li />").html("("+a.lat().format(4)+", "+a.lng().format(4)+")").appendTo(d)});3<=c.getLength()?(c=google.maps.geometry.spherical.computeArea(c),b.find(".jcsdl-map-area span").html(Math.round(c/1E6).format()+
" km<sup>2</sup>")):b.find(".jcsdl-map-area span").html("0 km<sup>2</sup>")}}}});JCSDL.Loader.addComponent(function(e){var j=function(b,a){var c=this;this.select=a.select;this.$carousel=b.find(".jcsdl-carousel");this.$carouselWrap=this.$carousel.closest(".jcsdl-carousel-wrap");this.$carouselItems=this.$carousel.find(".jcsdl-carousel-item");this.$scrollLeft=this.$carouselWrap.siblings(".jcsdl-carousel-scroll.left");this.$scrollRight=this.$carouselWrap.siblings(".jcsdl-carousel-scroll.right");this.itemsCount=this.$carouselItems.filter(":visible").length;var d=this.$carouselItems.eq(0),
f=d.is(":visible")?!1:!0;d.show();this.itemWidth=d.outerWidth(!0);this.itemMargin=parseInt(d.css("marginRight"));this.$carouselWrap.css({maxWidth:this.calculateWrapWidth(),height:d.outerHeight(!0)});this.$carousel.css({position:"relative",width:this.itemWidth*this.itemsCount,height:d.outerHeight(!0)});this.margin=this.calculateCenterMargin();f&&d.hide();d=this.$carouselItems.filter(".selected");this.selectedIndex=1==d.length?d.prevAll(":visible").length:Math.floor(this.itemsCount/2);0==this.itemsCount%
2&&(this.selectedIndex-=0.5);this.changePosition(0,!a.expand);this.$carouselWrap.siblings(".jcsdl-carousel-scroll").bind("click touchstart",function(b){b.preventDefault();b.target.blur();b=e(this);b.hasClass("inactive")||(b=b.is(".left")?-1:1,0.5==c.selectedIndex-Math.floor(c.selectedIndex)&&(c.selectedIndex=0>b?c.selectedIndex:c.selectedIndex-1),c.selectedIndex=Math.round(c.selectedIndex)+b,c.changePosition(a.speed))});this.$carouselItems.bind("mousedown.jcsdlcarousel touchstart.jcsdlcarousel",function(b){b.preventDefault();
b.target.blur();var d=e(this),f=!1,j="touchmove"==b.type?b.originalEvent.targetTouches[0].pageX:b.pageX;e("body").bind("mousemove.jcsdlcarousel touchmove.jcsdlcarousel",function(a){f=!0;a="touchmove"==a.type?a.originalEvent.targetTouches[0].pageX:a.pageX;var b=parseInt(c.$carousel.css("left"));c.$carousel.css("left",b-(j-a));j=a});e("body").bind("mouseup.jcsdlcarousel touchend.jcsdlcarousel",function(){f?c.snapToSelection():(c.selectedIndex=d.prevAll(":visible").length,c.changePosition(a.speed),f=
!1);e("body").unbind("mousemove.jcsdlcarousel touchmove.jcsdlcarousel");e("body").unbind("mouseup.jcsdlcarousel touchend.jcsdlcarousel")})});this.$carouselItems.bind("jcsdlclick",function(){e(this).show();c.itemsCount=c.$carouselItems.filter(":visible").length;c.$carousel.css("width",c.itemWidth*c.itemsCount);e(this).trigger("mousedown").trigger("mouseup")});this.$carouselItems.click(function(b){b.preventDefault();b.target.blur();e("html").is(".msie")&&(c.selectedIndex=e(this).prevAll(":visible").length,
c.changePosition(a.speed))});e(window).resize(function(){c.adjust()});this.$carouselItems.filter(":visible")};j.prototype={calculateWrapWidth:function(){return this.$carouselWrap.closest(".jcsdl-step").width()-this.$scrollLeft.outerWidth(!0)-this.$scrollRight.outerWidth(!0)},calculateCenterMargin:function(){return this.margin=(this.$carouselWrap.width()-this.itemWidth+this.itemMargin)/2},calculateCurrentPosition:function(){return-1*this.itemWidth*this.selectedIndex+this.margin},toggleScrollButtons:function(){this.$scrollLeft.removeClass("inactive");
this.$scrollRight.removeClass("inactive");0==this.selectedIndex&&this.$scrollLeft.addClass("inactive");this.selectedIndex+1>=this.itemsCount&&this.$scrollRight.addClass("inactive")},getSelectedItem:function(){return this.$carouselItems.filter(":visible").eq(this.selectedIndex)},snapToSelection:function(){var b=parseInt(this.$carousel.css("left"));this.selectedIndex=Math.round((b-this.margin)/(-1*this.itemWidth));this.selectedIndex=0>this.selectedIndex?0:this.selectedIndex;this.selectedIndex=this.selectedIndex+
1>this.itemsCount?this.itemsCount-1:this.selectedIndex;this.changePosition(100)},changePosition:function(b,a){var c=this;a=a||!1;this.$carousel.animate({left:this.calculateCurrentPosition()},b,function(){c.adjust()});this.toggleScrollButtons();!a&&("function"==typeof this.select&&0<this.itemsCount)&&this.select.apply(this.getSelectedItem())},adjust:function(){this.$carouselWrap.css({maxWidth:this.calculateWrapWidth()});this.calculateCenterMargin();this.$carousel.css({left:this.calculateCurrentPosition()})}};
e.fn.jcsdlCarousel=function(b){function a(a){var d=a.data("jcsdlCarousel");d||(d=new j(a,b),a.data("jcsdlCarousel",d));return d}if("string"==typeof b)return 0<=e.inArray(b,["adjust"])&&this.each(function(){var c=a(e(this));c[b].apply(c,[])}),this;b=e.extend({},{select:function(){},expand:!1,speed:200},b);this.each(function(){a(e(this))});return this}});
JCSDL.Loader.addComponent(function(e){e.fn.jcsdlNumberMask=function(j,b){this.each(function(){e(this).keydown(function(a){(190==a.which||110==a.which)&&(0<=e(this).val().indexOf(".")||!j)?a.preventDefault():a.shiftKey||a.altKey?a.preventDefault():46==a.which||(8==a.which||9==a.which||27==a.which||190==a.which||110==a.which||188==a.which&&b||65==a.which&&!0===a.ctrlKey||35<=a.which&&39>=a.which||13==a.which)||(48>a.which||57<a.which)&&(96>a.which||105<a.which)&&a.preventDefault()})});return this}});
JCSDL.Loader.addComponent(function(e,j){e.fn.jcsdlOrigVal=e.fn.val;e.fn.val=function(a){if(!this[0])return j;var b=e(this[0]);return b.data("jcsdlTagInput")&&a!==j?(b.jcsdlOrigVal(a),b.trigger("change"),b):a!==j?b.jcsdlOrigVal(a):b.jcsdlOrigVal()};var b=function(a,b){var d=this;this.delimeter=b.delimeter;this.numbers=b.numbers;this.floats=b.floats;this.$original=a;this.$original.data("jcsdlTagInputEnabled",!0);this.$wrap=e(this.tpl);this.$inputWrap=this.$wrap.find(".jcsdl-tag-field");this.$input=
this.$inputWrap.find("input");this.inputPh=this.$original.attr("placeholder");this.$input.attr("placeholder",this.inputPh);this.$original.hide().data("jcsdlTagValue",[]);this.$wrap.insertAfter(this.$original);this.$inputSizeHelper=e("<div />").addClass("jcsdl-tag-field-helper").css({position:"absolute",left:-9999,bottom:-9999,minWidth:100,width:"auto",textAlign:"left"}).appendTo(this.$inputWrap);this.numbers&&this.$input.jcsdlNumberMask(this.floats,!0);this.update();this.$wrap.bind("click touchstart",
function(){d.$input.focus()});this.$original.bind("change.jcsdltaginput",function(){!d.updating&&e(this).data("jcsdlTagInputEnabled")&&d.update()});this.$input.blur(function(){var a=d.$input.val();0!=a.length&&d.addTag(a)});this.$input.bind("paste.jcsdltaginput",function(){setTimeout(function(){var a=d.$input.val();0!=a.length&&d.addTag(a)},10)});this.$input.bind("keypress.jcsdltaginput",function(a){e(this).val();13==a.which?(a.preventDefault(),d.addTag(e(this).val())):d.reposition()});this.$input.bind("keydown.jcsdltaginput",
function(a){8==a.which&&0==e(this).val().length&&(a.preventDefault(),d.removeTag(d.$wrap.find(".jcsdl-tag:last")))});this.$input.bind("keyup.jcsdltaginput",function(){var a=e(this).val();a.charCodeAt(a.length-1)==d.delimeter.charCodeAt(0)&&"\\"!=a.charAt(a.length-2)&&d.addTag(a.substr(0,a.length-1))})};b.prototype={tpl:'<div class="jcsdl-tag-input"><div class="jcsdl-tag-field"><input type="text" /></div></div>',tagTpl:'<span class="jcsdl-tag"><span /><a href="#" class="jcsdl-tag-remove jcsdl-elements-sprite" title="Remove"></a></span>',
updating:!1,delimeter:",",numbers:!1,numbersArrVal:[],floats:!1,addTag:function(a){this.$input.val("");if(!(a===j||0==a.length)){var b=this,d=e(this.tagTpl);d.find("span").html(a.truncate());d.insertBefore(this.$inputWrap);var f=this.$original.data("jcsdlTagValue");f.push(a);this.$original.data("jcsdlTagValue",f);this.$original.val(f.join(this.delimeter));this.$input.attr("placeholder","");d.find("a").bind("click touchstart",function(a){a.preventDefault();a.target.blur();b.removeTag(d)});this.reposition()}},
removeTag:function(a){if(0!=a.length){var b=this.$wrap.find(".jcsdl-tag").index(a);a.remove();a=this.$original.data("jcsdlTagValue");a.splice(b,1);this.$original.data("jcsdlTagValue",a);this.$original.val(a.join(this.delimeter));0==a.length&&this.$input.attr("placeholder",this.inputPh);this.reposition()}},update:function(a){a=a?RegExp(/[\s,]+/g):this.delimeter;var b=this.$original.val();if(0!=b.length){var d=this;this.$original.data("jcsdlTagValue",[]);this.$wrap.find(".jcsdl-tag").remove();this.updating=
!0;var f=b.split(a),h=[];e.each(f,function(a,b){if(b===j)return!0;"\\"==b.charAt(b.length-1)&&(b+=d.delimeter+f[a+1],f.splice(a+1,1));h.push(b)});f=h;e.each(f,function(a,b){d.addTag(b)});this.updating=!1;this.reposition()}},reposition:function(){var a=this.$input.val().escapeHtml();0==a.length&&(a=this.$input.attr("placeholder"));this.$inputSizeHelper.html(a);this.$input.css({width:this.$inputSizeHelper.width()+32+"px",maxWidth:this.$wrap.width()-30,"font-size":this.$input.css("font-size"),"font-family":this.$input.css("font-family"),
"font-weight":this.$input.css("font-weight"),"letter-spacing":this.$input.css("letter-spacing"),whiteSpace:"nowrap"})},enable:function(){this.numbers&&(this.$original.data("jcsdlTagInputEnabled")?this.numbersArrVal=this.$original.val().split(this.delimeter):this.numbersArrVal[0]=this.$original.val());this.$original.data("jcsdlTagInputEnabled",!0);this.numbers&&this.$original.val(this.numbersArrVal.join(this.delimeter));this.$original.hide();this.$wrap.show()},disable:function(){if(this.numbers){var a=
"";this.$original.data("jcsdlTagInputEnabled")?(this.numbersArrVal=this.$original.val().split(this.delimeter),a=this.numbersArrVal[0]):a=this.$original.val()}this.$original.data("jcsdlTagInputEnabled",!1);this.numbers&&this.$original.val(a);this.$original.show();this.$wrap.hide()}};e.fn.jcsdlTagInput=function(a){function c(c){var d=c.data("jcsdlTagInput");d||(d=new b(c,a),c.data("jcsdlTagInput",d));return d}if("string"==typeof a){if(0<=e.inArray(a,["enable","disable","reposition","update","setDelimeter"])){var d=
[];e.each(arguments,function(a,b){if(0==a)return!0;d.push(b)});this.each(function(){var b=c(e(this));b[a].apply(b,d)})}return this}a=e.extend({},{delimeter:",",numbers:!1,floats:!1},a);this.each(function(){c(e(this))});return this}});
JCSDL.Loader.addComponent(function(e,j){var b=function(a,b){var d=this;this.$el=a;this.exp=RegExp();this.$btn=e('<a href="#" class="jcsdl-regex-tester-button jcsdl-elements-sprite">Test</a>').insertAfter(this.$el);this.$wrap=e('<div class="jcsdl-regex-tester"><p>If you want to test whether your regular expression correctly matches the desired strings, click the "Test" button and input example content in the shown field.</p></div>').insertAfter(this.$el).hide();this.$fields=e();this.$fieldsWraps=e();
for(var f=1;f<=b.fields;f++){var h=this.$el.clone().removeClass("orig").show().attr("placeholder","Test your expression against this field..."),m=e('<div class="jcsdl-regex-tester-input-wrap" />').html(h).append('<div class="jcsdl-regex-result jcsdl-elements-sprite" />');m.prependTo(this.$wrap);this.$fields=this.$fields.add(h);this.$fieldsWraps=this.$fieldsWraps.add(m)}this.$btn.bind("click touchstart",function(a){a.preventDefault();a.target.blur();d.$fieldsWraps.fadeIn();e(this).addClass("active")});
this.$el.bind("keyup change",function(){d.val=d.$el.val();d.test()});this.$fields.bind("keyup",function(){d.test(e(this))});this.disable()};b.prototype={mode:"partial",val:"",test:function(a){var b=this;a=a!==j?a:this.$fields;var d=this.val.replace(/\//g,"/");this.exp=RegExp("partial"==this.mode?""+d+"":"^"+d+"$","i");a.each(function(a,d){if(0==e(d).val().length||0==b.val.length)return e(d).siblings(".jcsdl-regex-result").hide(),!0;var m=b.exp.test(e(d).val())?"ok":"err";e(d).siblings(".jcsdl-regex-result").removeClass("ok err").addClass(m).fadeIn()})},
enable:function(){this.$el.data("jcsdlRegExTesterEnabled",!0);this.$el.addClass("jcsdl-regex-active");this.$wrap.fadeIn();this.$btn.fadeIn()},disable:function(){this.$el.data("jcsdlRegExTesterEnabled",!1);this.$el.removeClass("jcsdl-regex-active");this.$wrap.hide();this.$fieldsWraps.hide();this.$btn.hide()},setPartial:function(){this.mode="partial"},setExact:function(){this.mode="exact"}};e.fn.jcsdlRegExTester=function(a){function c(c){var e=c.data("jcsdlRegExTester");e||(e=new b(c,a),c.data("jcsdlRegExTester",
e));return e}if("string"==typeof a)return 0<=e.inArray(a,["enable","disable","setPartial","setExact","test"])&&this.each(function(){var b=c(e(this));b[a].apply(b,[])}),this;a=e.extend({},{fields:1},a);this.each(function(){c(e(this))});return this}});
JCSDL.Loader.addComponent(function(e){var j=e(window),b=function(a){var b=this;this.config=e.extend({},this.config,a);this.$overlay=e('<div class="jcsdl-overlay" />').appendTo("body").hide();this.$popup=e('<div class="jcsdl-popup"><div class="jcsdl-popup-header jcsdl-elements-sprite"><h4 /><a href="#" class="jcsdl-popup-close jcsdl-elements-sprite">Close</a></div><div class="jcsdl-popup-content" /></div>').appendTo("body").hide();this.config.title&&this.setTitle(this.config.title);this.config.content&&
this.setContent(this.config.content);this.$popup.css({minWidth:this.config.minWidth,maxWidth:this.config.maxWidth});this.setWidth(this.config.width);this.config.autoshow&&this.show();this.$popup.find(".jcsdl-popup-close").click(function(a){a.preventDefault();a.target.blur();a.stopPropagation();b.close()});e(window).resize(function(){b.$popup.is(":visible")&&b.reposition()})};b.prototype={$popup:e(),$overlay:e(),config:{width:700,minWidth:280,maxWidth:"70%",title:"",content:'<div class="jcsdl-popup-loading"></div>',
autoshow:!0,overlay:!0},getTitle:function(){return this.$popup.find(".jcsdl-popup-header h4").html()},setTitle:function(a){this.$popup.find(".jcsdl-popup-header h4").html(a);this.config.title=a},getContent:function(){return this.$popup.find(".jcsdl-popup-content")},setContent:function(a){a=e.trim(a);var b="string"===typeof a&&"<"!==a.charAt(0)?e("<p>"+a+"</p>"):e(a),d=this.$popup.find(".jcsdl-popup-content");d.html("");b.each(function(a,b){d.append(e(b))});this.config.content=a},setWidth:function(a){this.$popup.width(a)},
reposition:function(){this.$popup.css("position","fixed");this.$popup.find(".jcsdl-popup-content").css("maxHeight",0.7*j.height());var a=Math.max(0,(j.width()-this.$popup.outerWidth())/2),b=Math.max(0,(j.height()-this.$popup.outerHeight())/2);this.$popup.css({left:a+"px",top:b+"px"})},show:function(){this.config.overlay&&this.$overlay.show();this.$popup.show();this.reposition()},hide:function(){this.$overlay.hide();this.$popup.hide()},close:function(){this.$overlay.remove();this.$popup.remove()}};
e.jcsdlPopup=function(a){return new b(a)}});JCSDL.Loader.addComponent(function(e,j){e.fn.animateIntoView=function(b,a,c){b=b===j?200:b;a=parseInt(a)||0;c="function"==typeof c?c:function(){};var d=e(this[0]);if(!d.length)return this;var f=e("body"),h=e("html"),d=d.offset().top,m=parseInt(f.scrollTop()),g=m+e(window).height();if(m<d&&d<g)return this;f.add(h).animate({scrollTop:d-a},b,c);return this}});
var jcsdlMapsLoaded=!1,jcsdlMapsCurrentGui=null,jcsdlMapsCurrentCallback=function(){},jcsdlMapsCurrentCallbackArgs=[],jcsdlMapsOptions={},loadGoogleMapsApi=function(e,j,b){jcsdlMapsCurrentGui=e;jcsdlMapsCurrentCallback=j;jcsdlMapsCurrentCallbackArgs=b;jcsdlMapsLoaded?jcsdlMapsInit():(e=0<jcsdlMapsCurrentGui.config.googleMapsApiKey.length?"key="+jcsdlMapsCurrentGui.config.googleMapsApiKey+"&":"",j="file:"==window.location.protocol?"http:":"",jQuery("body").append('<script type="text/javascript" src="'+
j+"//maps.googleapis.com/maps/api/js?"+e+'libraries=places,geometry&sensor=false&callback=jcsdlMapsInit" />'),jcsdlMapsLoaded=!0)},jcsdlMapsInit=function(){jcsdlMapsOptions={center:new google.maps.LatLng(40,0),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}};google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=
function(){for(var e=new google.maps.LatLngBounds,j=this.getPaths(),b,a=0;a<j.getLength();a++){b=j.getAt(a);for(var c=0;c<b.getLength();c++)e.extend(b.getAt(c))}return e});jcsdlMapsCurrentGui&&jcsdlMapsCurrentCallback&&setTimeout(function(){jcsdlMapsCurrentCallback.apply(jcsdlMapsCurrentGui.inputs,jcsdlMapsCurrentCallbackArgs)},jcsdlMapsCurrentGui.config.animate+10)};
JCSDL.Loader.addComponent(function(e,j){e.extend(String.prototype,{truncate:function(b,a,c){b=b||72;a=a||"...";if(this.length<=b)return this.valueOf();s=this.substr(0,b);c||(s=s.substr(0,s.lastIndexOf(" ")));return s+a},isNumeric:function(){return!isNaN(parseInt(this.valueOf()))},escapeHtml:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},unescapeHtml:function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,
'"')},escapeCsdl:function(){return this.replace(/\\(?![,:]+)/g,"\\\\").replace(/"/g,'\\"')},unescapeCsdl:function(){return this.replace(/\\"/g,'"').replace(/\\\\/g,"\\")}});e.extend(Number.prototype,{format:function(b,a,c){var d=this.toString().replace(/[^0-9+\-Ee.]/g,""),d=!isFinite(+d)?0:+d;b=!isFinite(+b)?0:Math.abs(b);c=c===j?",":c;a=a===j?".":a;var e="",e=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c},e=(b?e(d,b):""+Math.round(d)).split(".");3<e[0].length&&(e[0]=e[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,
c));if((e[1]||"").length<b)e[1]=e[1]||"",e[1]+=Array(b-e[1].length+1).join("0");return e.join(a)}})});JCSDL.Loader.addComponent(function(e,j){this.GUIFilterEditor=function(b,a,c){a=a||e();c=c||{};var d=this;this.gui=b;this.config=b.config;this.definition=b.definition;this.parser=b.parser;this.inputs=b.inputs;this.getTemplate=b.getTemplate;this.getIconForField=b.getIconForField;this.filter=c;this.steps=[];this.target=null;this.path=[];this.$view=this.getTemplate("filterEditor");this.$steps=this.$view.find(".jcsdl-steps");this.$view.appendTo(a).show();this.addFilterStep("target",this.createTargetSelectView());
this.$view.find(".jcsdl-filter-save").hide();this.$view.find(".jcsdl-footer span").hide();this.$view.find(".jcsdl-filter-save").bind("click touchstart",function(a){a.preventDefault();a.target.blur();d.didSubmitFilter()});this.$view.find(".jcsdl-filter-cancel").bind("click touchstart",function(a){a.preventDefault();a.target.blur();d.gui.hideFilterEditor();d.trigger("filterCancel")});this.loadFilter(c)};this.GUIFilterEditor.prototype={filter:{},jsonpCache:{operators:{},targets:{}},adjust:function(){this.$steps.find(".jcsdl-step").jcsdlCarousel("adjust")},
loadFilter:function(b){var a=this;this.filter=b;if(b===j||!b||b.target===j)return!1;var c=this.parser.getFieldInfo(b.target,b.fieldPath);this.$view.find(".jcsdl-filter-target .target-"+b.target).trigger("jcsdlclick");e.each(b.fieldPath,function(b,c){a.$view.find(".jcsdl-filter-target-field:last").find(".field-"+c).trigger("jcsdlclick")});"string"!==typeof c.input&&this.$view.find(".jcsdl-filter-target-field-input .input-"+b.operator).trigger("jcsdlclick");"text"===c.input?e(".jcsdl-dropdown .jcsdl-dropdown-option.operator-"+
b.operator).click():this.$view.find(".jcsdl-filter-value-input-operators .operator-"+b.operator).click();var d=this.$view.find(".jcsdl-filter-value-input-field");this.setValueForField(d,c,b.value,b.operator);b.cs&&this.$view.find(".jcsdl-operator-cs").click()},addFilterStep:function(b,a,c){c=c===j?!0:c;var d=this,f=this.getTemplate("step"),h=this.steps.length;f.html(a).data("number",h).addClass("jcsdl-filter-step-number-"+h).data("name",b).addClass("jcsdl-filter-step-"+b).appendTo(this.$steps);"target"===
b&&f.jcsdlCarousel({select:function(){var a=e(this);f.addClass("selected").find(".jcsdl-carousel-item.selected").removeClass("selected");a.addClass("selected");d.didSelectTarget(a.data("name"))}});"field"===b&&f.jcsdlCarousel({select:function(){var b=e(this);d.$steps.find(".jcsdl-filter-step-target").addClass("field-selected");var c=f.data("number")-1;d.$steps.find(".jcsdl-filter-step-field.jcsdl-filter-step-number-"+c).addClass("field-selected");f.addClass("selected").find(".jcsdl-carousel-item.selected").removeClass("selected");
b.addClass("selected");d.didSelectField(b.data("name"),a,f)}});"input"===b&&f.jcsdlCarousel({select:function(){var b=e(this),c=f.data("number")-1;d.$steps.find(".jcsdl-filter-step-field.jcsdl-filter-step-number-"+c).addClass("field-selected");f.addClass("selected").find(".jcsdl-carousel-item.selected").removeClass("selected");b.addClass("selected");d.didSelectInput(b.data("name"),a,f)}});"value"===b&&(this.$view.find(".jcsdl-filter-save").fadeIn(this.config.animate),this.$view.find(".jcsdl-footer span").show());
c?f.hide().slideDown(this.config.animate):"field"===b?f.find(".jcsdl-filter-target-field").hide().fadeIn(this.config.animate):f.hide().fadeIn(this.config.animate);setTimeout(function(){d.adjust()},this.config.animate);this.steps.push(f)},removeFilterStepsAfterPosition:function(b){this.$steps.find(".jcsdl-step").eq(b).removeClass("field-selected");b=this.steps.splice(b+1,this.steps.length-b);var a="";this.$view.find(".jcsdl-filter-save").hide();this.$view.find(".jcsdl-footer span").hide();e.each(b,
function(b,d){var f=e(d);b||(a=f.data("name"));f.remove()});return a},didSelectTarget:function(b){if(this.definition.targets[b]===j)return!1;this.target=b;this.path=[];var a=this.removeFilterStepsAfterPosition(0),c=this.createFieldSelectionView(this.definition.targets[b].fields);this.addFilterStep("field",c,"field"!==a);this.trigger("targetSelect",[b])},didSelectField:function(b,a,c){var d=a.data("position");this.path.splice(d,this.path.length-d);c.removeClass("selected-final").find(".jcsdl-target-help").remove();
d=this.getFieldInfoAtCurrentPath(b);if(!1!==d){var e=this.removeFilterStepsAfterPosition(a.closest(".jcsdl-step").data("number"));this.path.push(b);d.fields!==j?(a=this.createFieldSelectionView(d.fields),this.addFilterStep("field",a,"field"!==e)):"string"!==typeof d.input?(c="input"!==e,b=this.createInputSelectionView(d.input),this.addFilterStep("input",b,c)):(b=this.createValueInputView(d),this.addFilterStep("value",b,"value"!==e),this.addTargetHelpToStep(c),this.trigger("targetSelect",[this.getCurrentPath()]))}},
didSelectInput:function(b,a,c){a=this.removeFilterStepsAfterPosition(a.closest(".jcsdl-step").data("number"));c.removeClass("selected-final").find(".jcsdl-target-help").remove();b=this.createValueInputView(this.getFieldInfoAtCurrentPath(),b);this.addFilterStep("value",b,"value"!==a);this.addTargetHelpToStep(c)},addTargetHelpToStep:function(b){var a=this;this.getTemplate("targetHelp").appendTo(b);b.find(".jcsdl-target-help").click(function(b){b.preventDefault();b.target.blur();b=a.getFieldInfoAtCurrentPath();
var d=a.target,f=a.parser.getTargetInfo(d),h=a.path.join("-"),m=f.name,g=[];e.each(a.path,function(b,c){g.push(c);m+=" &raquo; "+a.parser.getFieldInfo(d,g).name});var l=h;"augmentation"!==d&&(l=d+"."+l);b=a.config.targetHelpUrl.apply(a,[l.replace(/-/g,"."),b]);var k=e.jcsdlPopup({title:m});a.jsonpCache.targets[l]===j?e.ajax({url:b,type:"GET",async:!1,jsonpCallback:"jcsdlJSONP",contentType:"application/json",dataType:"jsonp",success:function(b){!b||!b.html||!e.trim(b.html)?(k.setContent("<p>No documentation available.</p>"),
k.reposition()):(k.setContent(b.html),k.reposition(),a.jsonpCache.targets[l]=b.html)},error:function(){k.setContent("<p>No documentation available.</p>");k.reposition()}}):(k.setContent(a.jsonpCache.targets[l]),k.reposition())})},didSubmitFilter:function(){var b=this.getFilterInfo();b&&this.gui.didSubmitFilter(b)},showError:function(b,a){this.$view.find(".jcsdl-error").remove();var c=this.getTemplate("error");c.find("span").html(b);c.prependTo(this.$view.find(".jcsdl-footer")).hide().fadeIn();window.console!==
j&&window.console.error(b,arguments)},trigger:function(b,a){this.gui.trigger(b,a)},createTargetSelectView:function(){var b=this,a=this.getTemplate("target"),c=a.find(".jcsdl-filter-target");e.each(this.definition.targets,function(a,e){b.createOptionForTarget(a,e).appendTo(c)});return a},createOptionForTarget:function(b,a){var c=this.getTemplate("targetOption").data("name",b).data("target",a).addClass("target-"+b);this.isTargetVisible(b)||(c.addClass("jcsdl-option-hidden"),(this.filter.target===j||
this.filter.target!==b)&&c.hide());return c},createFieldSelectionView:function(b){var a=this,c=this.path.length,d=this.target+(0<this.path.length?"."+this.path.join("."):""),f=this.getTemplate("field"),h=!1,j=e.merge([this.target],this.path),g="";f.data("position",c).addClass("field-select-"+c);e.each(j,function(b,c){g=g+(0<b?".":"")+c;if(!a.isTargetVisible(g))return h=!0});var l=f.find(".jcsdl-filter-target-field");e.each(b,function(b,c){a.createOptionForField(b,c,d,h).appendTo(l)});return f},createOptionForField:function(b,
a,c,d){var f=this;a=this.getTemplate("fieldOption").data("name",b).data("field",a).html(a.name).addClass("icon-"+this.getIconForField(b,a)).addClass("field-"+b);if(!d){var h=c+"."+b;if(this.isTargetVisible(h)){var h=h.split("-"),m="";e.each(h,function(a,b){m+=(0<a?".":"")+b;if(!f.isTargetVisible(m))return d=!0})}else d=!0}d&&a.addClass("jcsdl-option-hidden");d&&this.filter&&this.filter.target!==j&&this.filter.fieldPath!==j&&this.filter.target+"."+this.filter.fieldPath.join(".").replace(/-/g,".")===
c+"."+b&&(d=!1);d&&a.hide();return a},createInputSelectionView:function(b){var a=this,c=this.getTemplate("inputSelect"),d=c.find(".jcsdl-filter-target-field-input");e.each(b,function(b,c){a.createOptionForInput(c).appendTo(d)});return c},createOptionForInput:function(b){return this.getTemplate("inputSelectOption").data("name",b).addClass("icon-"+b+" input-"+b).html(b)},createValueInputView:function(b,a){a=a||b.input;var c=this.getTemplate("valueInput");if(this.inputs[a]===j)return c;var d=this.inputs.exec(a,
"init",[b]),d=c.find(".jcsdl-filter-value-input-field").data("inputType",a).html(d),e=c.find(".jcsdl-filter-value-input-operators");"text"===a?this.createTextOperatorsSelectView(e,b,a,d):this.createOperatorsSelectView(e,b,a,d);return c},createOperatorsSelectView:function(b,a,c,d){var f=this,h=d.find("input:first"),m=this.definition.inputs[c]!==j?this.definition.inputs[c]:{},g=m.operators!==j?m.operators:[];e.each(a.operators,function(a,c){if(0<g.length&&-1===e.inArray(c,g))return!0;var d=f.createOperatorOptionView(c);
e("html").is(".msie")&&d.html("&nbsp;");b.append(d)});b.children().bind("click touchstart",function(a){a.preventDefault();a.target.blur();var g=e(this);a=g.data("name");b.children().removeClass("selected");g.addClass("selected");"exists"===a?d.fadeOut(f.config.animate):d.is(":visible")||d.fadeIn(f.config.animate);"number"===c&&(g=0<=e.inArray(a,m.arrayOperators)?"enable":"disable",h.jcsdlTagInput(g));f.trigger("operatorSelect",[a])});1===b.children().length?(b.children().eq(0).click(),b.children().hide()):
(a=b.find(".operator-"+(a.operator!==j?a.operator:m.operator)),0<a.length?a.click():b.find(".operator:not(.operator-exists):first").click());return b},createTextOperatorsSelectView:function(b,a,c,d){var f=this;e(".jcsdl-dropdown").remove();b.addClass("text");var h=d.find("input.orig"),m=this.getTemplate("textOperatorsSelect"),g=this.getTemplate("textOperatorsDropdown"),l=this.definition.inputs[c]!==j?this.definition.inputs[c]:{},k=l.operators!==j?l.operators:[];e.each(a.operators,function(a,b){if(0<
k.length&&-1===e.inArray(b,k))return!0;var c=f.createTextOperatorOptionView(b);g.append(c)});b.html(m).insertAfter(d);g.hide().appendTo("body");if(a.cs){var q=this.getTemplate("caseSensitivity");q.bind("click touchstart",function(a){a.preventDefault();a.target.blur();e(this).toggleClass("selected");f.trigger("caseSensitivityChange",[e(this).is(".selected")])}).tipsy({gravity:"s",offset:9});q.prependTo(b);m.addClass("has-cs")}m.click(function(a){a.preventDefault();a.target.blur();a.stopPropagation();
m.hasClass("active")?(g.slideUp(f.config.animate),m.removeClass("active")):(g.css({top:m.offset().top+m.outerHeight()-1,left:m.offset().left,width:m.outerWidth()-2}).slideDown(f.config.animate),m.addClass("active"),e("body").bind("click.jcsdldropdown",function(a){a=e(a.target).closest(".jcsdl-dropdown");if(null===a||!a.is(".jcsdl-dropdown"))m.removeClass("active"),g.slideUp(f.config.animate),e("body").unbind("click.jcsdldropdown")}))});g.find(".jcsdl-dropdown-details-trigger, .jcsdl-operator-help").click(function(a){a.preventDefault();
a.target.blur();a.stopPropagation();a=e(this).closest(".jcsdl-dropdown-option");var b=a.data("name"),c=e.jcsdlPopup({title:a.data("title")});f.jsonpCache.operators[b]===j?e.ajax({url:a.data("jsonp"),type:"GET",async:!1,jsonpCallback:"jcsdlJSONP",contentType:"application/json",dataType:"jsonp",success:function(a){!a||!a.html||!e.trim(a.html)?(c.setContent("<p>No documentation available.</p>"),c.reposition()):(c.setContent(a.html),c.reposition(),f.jsonpCache.operators[b]=a.html)}}):(c.setContent(f.jsonpCache.operators[b]),
c.reposition())});g.find(".jcsdl-dropdown-option").click(function(b){b.preventDefault();b.target.blur();m.removeClass("active");g.hide();b=e(this).data("name");var c=f.definition.operators[b];m.data("operator",b).find(".jcsdl-operator-label").html(c.label);"exists"===b?(d.fadeOut(f.config.animate),a.cs&&q.fadeOut(f.config.animate)):d.is(":visible")||(d.fadeIn(f.config.animate),a.cs&&q.fadeIn(f.config.animate));"contains_near"===b?(d.find(".jcsdl-containsnear-distance").fadeIn(),d.find(".jcsdl-tag-field input").bind("keydown.nospace",
function(a){32===a.which&&a.preventDefault()}),h.jcsdlTagInput("update",!0),h.data("split",!0)):(d.find(".jcsdl-containsnear-distance").hide(),d.find(".jcsdl-tag-field input").unbind("keydown.nospace"),h.data("split")&&(h.jcsdlTagInput("update"),h.data("split",!1)));c=0<=e.inArray(b,l.arrayOperators)?"enable":"disable";h.jcsdlTagInput(c);"enable"===c&&h.jcsdlTagInput("update");c=0<=e.inArray(b,["regex_partial","regex_exact"])?"enable":"disable";h.jcsdlRegExTester(c);"enable"===c&&(h.jcsdlRegExTester("set"+
("regex_partial"===b?"Partial":"Exact")),h.jcsdlRegExTester("test"));f.trigger("operatorSelect",[b])});e(window).resize(function(){m.hasClass("active")&&g.css({top:m.offset().top+m.outerHeight()-1,left:m.offset().left,width:m.outerWidth()-2})});1===g.find(".jcsdl-dropdown-option").length?g.find(".jcsdl-dropdown-option:first").click():(c=g.find(".jcsdl-dropdown-option.operator-"+(a.operator!==j?a.operator:l.operator)),0<c.length?c.click():g.find(".jcsdl-dropdown-option:not(.operator-exists):first").click());
return b},createOperatorOptionView:function(b){var a=this.definition.operators[b];return a===j?e():this.getTemplate("operatorOption").data("name",b).addClass("icon-"+b+" operator-"+b).attr("title",a.description).html(a.label).tipsy({gravity:"s",offset:9})},createTextOperatorOptionView:function(b){var a=this.definition.operators[b];if(a===j)return e();var c=this.getTemplate("textOperatorOption").data("name",b).data("title",a.label).addClass("operator-"+b);c.find(".jcsdl-icon").addClass("icon-"+b+" operator-"+
b+" selected");c.find(".jcsdl-operator-label span").html(a.label);c.find(".jcsdl-operator-desc").html(a.description);a.jsonp?c.data("jsonp",a.jsonp):(c.find(".jcsdl-dropdown-details-trigger").remove(),c.find(".jcsdl-operator-help").remove());return c},setValueForField:function(b,a,c,d){var f=this,h=b.data("inputType");if(this.inputs[h]===j)return!1;if(0<=e.inArray(h,["geo_box","geo_radius","geo_polygon"])){var m=jcsdlMapsCurrentGui,g=jcsdlMapsCurrentCallback,l=jcsdlMapsCurrentCallbackArgs;jcsdlMapsCurrentCallback=
function(){m&&g&&setTimeout(function(){g.apply(m.inputs,l);f.inputs.exec(h,"setValue",[b,a,c,d])},m.config.animate+10)}}else this.inputs.exec(h,"setValue",[b,a,c,d]);return!0},getValueFromField:function(b,a,c){var d=b.data("inputType");return this.inputs[d]===j?"":this.inputs.exec(d,"getValue",[b,a,c])},getView:function(){return this.$view},getFilterInfo:function(){var b=this.getFieldInfoAtCurrentPath(),a="text"===b.input?this.$view.find(".jcsdl-filter-value-input-operators .jcsdl-operators-select").data("operator"):
this.$view.find(".jcsdl-filter-value-input-operators .operator.selected").data("name");if(a===j)this.showError("You need to select an operator!");else{var c="";if("exists"!==a&&(c=this.$view.find(".jcsdl-filter-value-input-field"),c=this.getValueFromField(c,b,a),!c.length)){this.showError("You need to specify a value!");return}return{target:this.target,path:this.path,operator:a,value:c,additional:{cs:"exists"!==a&&b.cs&&0<this.$view.find(".jcsdl-operator-cs.selected").length?!0:!1}}}},getFieldInfoAtCurrentPath:function(b){var a=
this.path.slice(0);"string"===typeof b&&a.push(b);return this.parser.getFieldInfo(this.target,a)},getCurrentPath:function(){return this.target+(0<this.path.length?".":"")+this.path.join(".").replace(/-/g,".")},isTargetVisible:function(b){if(!b)return!1;var a=this.config.showTargets;if(a.length){if(0<=e.inArray(b,a))return!0;for(var c=b.split(".");c.length;){if(0<=e.inArray(c.join("."),a))return!0;c.pop()}b+=".";for(c=0;c<a.length;c++)if(0===a[c].indexOf(b))return!0;return!1}return-1===e.inArray(b,
this.config.hideTargets)}}});JCSDL.Loader.addComponent(function(e,j){this.GUILogic=function(b,a){var c=this;this.gui=b;this.config=b.config;this.parser=b.parser;this.getTemplate=b.getTemplate;this.$logicOptions=b.$mainView.find(".jcsdl-filters-logic .jcsdl-filters-logic-option:not(.jcsdl-advanced-option)");this.$advancedOptions=b.$mainView.find(".jcsdl-filters-logic .jcsdl-filters-logic-option.jcsdl-advanced-option");this.$insertBracketsButton=this.$advancedOptions.filter(".jcsdl-advanced-add-brackets");this.$insertNotOperatorButton=
this.$advancedOptions.filter(".jcsdl-advanced-add-not");this.$editor=b.$mainView.find(".jcsdl-advanced-container");this.$guiContainer=this.initGui(this.$editor.find(".jcsdl-advanced-gui-container"));this.$gui=this.$guiContainer.find(".jcsdl-advanced-gui");this.$manual=this.$editor.find(".jcsdl-advanced-manual");this.$manualInput=this.initManualInput(this.$manual.find("input"));this.$logicOptions.click(function(a){a.preventDefault();a.target.blur();a=e(this);if(a.is(".disabled")||a.is(".active"))return!1;
var b=c.logic;c.logic=a.data("logic");c.didSetLogic(b,!1)});this.$logicOptions.filter(".jcsdl-advanced").find(".jcsdl-logic-help").tipsy({gravity:"s",trigger:"manual",title:function(){return c.$editor.is(":visible")?e(this).data(c.$manual.is(":visible")?"textManual":"textGui"):e(this).data("textGeneral")}}).click(function(a){a.preventDefault();a.target.blur();a.stopPropagation();var b=e(this);b.tipsy("show");e("body").one("click",function(){b.tipsy("hide")})});this.$advancedOptions.filter(".jcsdl-advanced-manual-edit").click(function(a){a.preventDefault();
a.target.blur();a=e(this);if(a.is(".on")){try{c.validate(c.getManualString())}catch(b){c.showError(b);return}a.removeClass("on");a.html(a.data("textGui"));c.$manualInput.blur();c.$manual.hide();c.$guiContainer.fadeIn(c.config.animate);c.$insertBracketsButton.removeClass("disabled");c.$insertNotOperatorButton.removeClass("disabled");c.setGuiString();c.trigger("graphicalLogic")}else{try{c.validate(c.getGuiString())}catch(d){c.showError(d);return}a.addClass("on");a.html(a.data("textManual"));c.setManualString();
c.$guiContainer.hide();c.$manual.fadeIn(c.config.animate);c.$manualInput.focus();c.$insertBracketsButton.addClass("disabled");c.$insertNotOperatorButton.addClass("disabled");c.trigger("manualLogic")}});try{this.setLogic(a,!0)}catch(d){this.showError(d,!0)}};this.GUILogic.prototype={ADVANCED:"ADVANCED",AND:"AND",OR:"OR",tokenize:function(b){b=b||this.logicString;return this.parser.tokenizeLogicString(b)},validate:function(b,a){b=b||this.logicString;a=a||this.gui.filters;return this.parser.validateLogic(b,
a)},showEditor:function(){this.$editor.show();this.adjustGui();this.$editor.hide().slideDown(this.config.animate);this.gui.$mainView.addClass("jcsdl-advanced-on")},hideEditor:function(){this.$editor.slideUp(this.config.animate);this.gui.$mainView.removeClass("jcsdl-advanced-on")},toggleButtons:function(b){(b=b===j?!0:b)||this.setLogic(this.AND);this.$logicOptions[b?"removeClass":"addClass"]("disabled")},showError:function(b,a){a=a||!1;this.clearErrors();var c=b instanceof JCSDL.LogicValidationException?
b.message:b,d=this.getTemplate("error");d.find("span").html(c);d.insertAfter(this.$editor).show();a||this.trigger("logicError",[b]);a||(this.trigger("logicError",[b]),console!==j&&console.error(b,arguments));b instanceof JCSDL.LogicValidationException&&this.$gui.is(":visible")&&0<=b.index&&(c=this.$gui.children().not(".jcsdl-token-ph").eq(b.index).find(".jcsdl-logic-token").addClass("jcsdl-logic-error"),this.scrollGuiToToken(c));d.animateIntoView(this.config.animate)},trigger:function(b,a){this.gui.trigger(b,
a)},clearErrors:function(){this.gui.clearErrors();this.$gui.find(".jcsdl-logic-error").removeClass("jcsdl-logic-error")},initGui:function(b){var a=this,c=b.find(".jcsdl-advanced-gui"),d=null;this.$guiLeft=b.find(".jcsdl-advanced-gui-arrow.left");this.$guiRight=b.find(".jcsdl-advanced-gui-arrow.right");c.sortable({cursor:"move",placeholder:"jcsdl-token-ph",containment:b,appendTo:b,helper:"clone",tolerance:"intersect",start:function(a,b){b.item.find(".jcsdl-logic-token").is(".bracket")&&c.find(".jcsdl-token-ph").addClass("bracket")},
stop:function(b,c){var d=c.item.find(".jcsdl-logic-token");d.is(".filter")&&a.gui.highlightFilter(d.data("token"),!1)},sort:function(b,c){clearInterval(d);a.$guiRight.is(":visible")&&c.offset.left+c.helper.width()/2>=a.$guiRight.offset().left&&(d=setInterval(function(){a.scrollGui("right",50)},50));a.$guiLeft.is(":visible")&&c.offset.left<=a.$guiLeft.offset().left+c.helper.width()/2&&(d=setInterval(function(){a.scrollGui("left",50)},50));var e=c.helper.find(".jcsdl-logic-token");e.is(".filter")&&
a.gui.highlightFilter(e.html())},update:function(){clearInterval(d);setTimeout(function(){a.updateFromGui();var b=a.getGuiString();a.trigger("graphicalLogicTokenMove",[b]);a.trigger("graphicalLogicChange",[b]);a.trigger("advancedLogicChange",[b])},100)}});(c.data("sortable")||{}).floating=!0;(c.data("uiSortable")||{}).floating=!0;this.$insertBracketsButton.click(function(b){b.preventDefault();b.target.blur();if(e(this).is(".disabled"))return!1;a.addGuiToken(")",!0,!0);a.updateFromGui();b=a.getGuiString();
a.trigger("parenthesisAdd",[b]);a.trigger("graphicalLogicChange",[b]);a.trigger("advancedLogicChange",[b])});this.$insertNotOperatorButton.click(function(b){b.preventDefault();b.target.blur();if(e(this).is(".disabled"))return!1;a.addGuiToken("!",!0,!0);a.updateFromGui();b=a.getGuiString();a.trigger("notOperatorAdd",[b]);a.trigger("graphicalLogicChange",[b]);a.trigger("advancedLogicChange",[b])});this.$guiRight.add(this.$guiLeft).bind("mousedown touchstart",function(){var b=e(this).is(".right")?"right":
"left";d=setInterval(function(){a.scrollGui(b,50)},50)}).bind("mouseup mouseleave touchend",function(){clearInterval(d)}).click(function(a){a.preventDefault();a.target.blur()});e(window).resize(function(){a.adjustGui()});return b},updateFromGui:function(){var b=this.getGuiTokens();try{this.validate(b)&&(this.clearErrors(),this.logicString=b.join(""))}catch(a){this.showError(a,!0)}},setGuiString:function(b){b=b||this.logicString;var a=this;b="string"===typeof b||"number"===typeof b?this.tokenize(b):
b;this.clearGui();e.each(b,function(b,d){a.addGuiToken(d,!1)})},getGuiString:function(b){b=b||this.$gui;var a="";b.find(".jcsdl-logic-token").each(function(){a+=""+e(this).data("token")});return a},getGuiTokens:function(b){b=b||this.$gui;var a=[];b.find(".jcsdl-logic-token").each(function(){a.push(e(this).data("token"))});return a},clearGui:function(){this.$gui.width(0).children().remove()},tokensMap:{"(":"bracketOpen",")":"bracketClose","&":"operatorAnd","|":"operatorOr","!":"operatorNot",filter:"filter"},
addGuiToken:function(b,a,c){a=a===j?!0:a;c=c===j?!1:c;var d=this,f="number"==typeof b?"filter":b;if(this.tokensMap[f]===j)throw'Invalid character "'+b+'" in the logic!';var h=this.getTemplate("logicToken_"+this.tokensMap[f]).data("token",b),m=e();"filter"==f&&h.html(b);f=e('<li class="jcsdl-logic-token-wrap" />').html(h)["!"===b&&c?"prependTo":"appendTo"](this.$gui);this.$gui.width(this.$gui.width()+f.outerWidth(!0));if(")"==b&&c){m=this.getTemplate("logicToken_bracketOpen").data("token","(");b=this.getGuiTokens().reverse();
var g=b.length,l=-1,k=null;e.each(b,function(a,b){")"==b?l++:"("==b&&l--;if(0==l&&0<=e.inArray(b,["&","|"])){if(null!==k&&b!==k)return g=a,!1;k=b}});b=this.$gui.children().eq(b.length-g);b=e('<li class="jcsdl-logic-token-wrap" />').html(m).insertBefore(b);this.$gui.width(this.$gui.width()+b.outerWidth(!0))}this.updateFromGui();this.adjustGui();a&&this.scrollGuiToToken(h);h.click(function(a){a.preventDefault();a.target.blur();"&"==h.data("token")?(h.data("token","|").html("OR"),d.trigger("logicOperatorSwitch",
["OR"]),a=d.getGuiString(),d.trigger("graphicalLogicChange",[a]),d.trigger("advancedLogicChange",[a])):"|"==h.data("token")&&(h.data("token","&").html("AND"),d.trigger("logicOperatorSwitch",["AND"]),a=d.getGuiString(),d.trigger("graphicalLogicChange",[a]),d.trigger("advancedLogicChange",[a]));d.updateFromGui()});h.add(m).find(".jcsdl-delete-token").click(function(a){a.preventDefault();a.target.blur();a.stopPropagation(!0);d.deleteGuiToken(h);a=d.getGuiString();var b="!"===h.data("token")?"notOperatorDelete":
"parenthesisDelete";d.trigger(b,[a]);d.trigger("graphicalLogicChange",[a]);d.trigger("advancedLogicChange",[a])});h.filter(".filter").hover(function(){d.gui.highlightFilter(e(this).data("token"))},function(){d.gui.highlightFilter(e(this).data("token"),!1)})},deleteGuiFilterToken:function(b){b=parseInt(b);var a=e(),c=e();this.$gui.children().each(function(){var c=e(this);if(parseInt(c.find(".jcsdl-logic-token").data("token"))===b)return a=c,!1});if(!a.length)return!1;for(;"("==a.prev().find(".jcsdl-logic-token").data("token")&&
")"==a.next().find(".jcsdl-logic-token").data("token");)a.prev().remove(),a.next().remove();a.prev().find(".jcsdl-logic-token.operator").length?c=a.prev():a.next().find(".jcsdl-logic-token.operator").length&&(c=a.next());a.remove();c.remove();this.updateFromGui();c=this.getGuiString();this.trigger("graphicalLogicChange",[c]);this.trigger("advancedLogicChange",[c])},deleteGuiToken:function(b){var a=b.is(".jcsdl-logic-token")?b.closest("li.jcsdl-logic-token-wrap"):b;if(!a.is("li.jcsdl-logic-token-wrap"))return!1;
b=a.find(".jcsdl-logic-token");if(b.is(".operator")&&"!"!==b.data("token"))return!1;if(b.is(".filter")){var c=b.data("token"),d=!1;e.each(this.gui.filters,function(a,b){if(parseInt(b.id)==parseInt(c))return d=!0,!1});if(d)return!1}else if(b.is(".bracket")){var f=this.getGuiTokens(),h=this.$gui.children().index(a),j=null,g=0,l=0,k=")",q="(",n=")";")"==b.data("token")&&(f=f.reverse(),h=f.length-1-h,k="(",q=")",n="(");e.each(f,function(a,b){if(a==h)return l=g,!0;if(null!==l&&g==l&&a>h&&b==k)return j=
"("==k?f.length-1-a:a,!1;b==q?g++:b==n&&g--});null!==j&&(b=this.$gui.children().filter(".jcsdl-logic-token-wrap").eq(j),this.$gui.width(this.$gui.width()-b.outerWidth(!0)),b.remove())}this.$gui.width(this.$gui.width()-a.outerWidth(!0));a.remove();this.updateFromGui();this.adjustGui()},_adjustGuiTimeout:null,adjustGui:function(){var b=this,a=0;this.$gui.children().each(function(){a+=parseInt(e(this).outerWidth(!0))});this.$gui.width(a).css("minWidth",parseInt(0.9*this.$gui.parent().width(),10));clearTimeout(this._adjustGuiTimeout);
this._adjustGuiTimeout=setTimeout(function(){var a=b.$gui.width(),d=b.$guiContainer.width();a>d?b.$guiRight.removeClass("off"):(b.$guiLeft.add(b.$guiRight).addClass("off"),b.scrollGuiToStart())},50)},scrollGui:function(b,a){a=a==j?50:a;var c=-1*Math.max(0,this.$gui.width()-this.$guiContainer.width()),d=0,e=this,d="number"===typeof b?b:parseInt(this.$gui.css("left"))+("right"==b?-30:30),d=Math.max(Math.min(0,d),c);this.$gui.stop(!0,!0).animate({left:d},a,function(){e.$guiLeft[0==d?"addClass":"removeClass"]("off");
e.$guiRight[d==c?"addClass":"removeClass"]("off")})},scrollGuiToStart:function(){this.scrollGui(0)},scrollGuiToEnd:function(){this.scrollGuiToToken(this.$gui.children().last())},scrollGuiToToken:function(b){b=b.is(".jcsdl-logic-token")?b.closest("li.jcsdl-logic-token-wrap"):b;if(!b.is("li.jcsdl-logic-token-wrap"))return!1;b=-1*b.position().left;parseInt(this.$gui.css("left"));this.scrollGui(b+140)},initManualInput:function(b){var a=this,c=null;b.keyup(function(){clearTimeout(c);c=setTimeout(function(){var c=
b.val();a.logicString!==c&&(a.trigger("manualLogicChange",[c]),a.trigger("advancedLogicChange",[c]));try{a.validate(c)&&(a.clearErrors(),a.logicString=c)}catch(e){a.showError(e,!0)}},500)});b.keydown(function(a){var b=a.which,c=a.shiftKey;8==b||(37<=b&&40>=b||46==b||48<=b&&57>=b&&!c||96<=b&&105>=b||219==b||57==b&&c||221==b||48==b&&c||32==b||55==b&&c||220==b&&c||49==b&&c)||a.preventDefault()});b.keypress(function(a){13==a.which&&a.preventDefault()});return b},setManualString:function(b){b=b||this.logicString;
b="string"===typeof b||"number"===typeof b?this.tokenize(b):b;this.$manualInput.val(b.join(" "))},getManualString:function(){return this.$manualInput.val()},setLogic:function(b,a){a=a||!1;var c=this.logic;this.logic=-1<e.inArray(b,[this.AND,this.OR])?b:this.ADVANCED;var d="";if(this.logic==this.ADVANCED)d=b;else{var f=[];e.each(this.gui.filters,function(a,b){f.push(b.id)});d=f.join(this.logic==this.OR?"|":"&")}this.setLogicString(d);this.didSetLogic(c,a)},getLogic:function(){return this.logic},setLogicString:function(b){this.logicString=
""+b;this.setGuiString(b);this.setManualString(b)},appendFilterToLogicString:function(b,a){a=a||this.logic;a=a==this.OR?"|":"&";var c=this.logicString.length?this.logicString+a+b:b;this.trigger("manualLogicChange",[c]);this.trigger("graphicalLogicChange",[c]);this.trigger("advancedLogicChange",[c]);this.setLogicString(c)},getLogicString:function(){return this.logic==this.ADVANCED?this.logicString:this.logic},didSetLogic:function(b,a){b=b||"";a=a||!1;this.$logicOptions.removeClass("active").filter('[data-logic="'+
this.logic+'"]').addClass("active");this.logic==this.ADVANCED?(this.showEditor(),this.$logicOptions.not(".jcsdl-advanced").each(function(){var a=e(this);a.html(a.data("textShort"))}),this.$advancedOptions.fadeIn(this.config.animate)):(this.clearErrors(),this.hideEditor(),this.$logicOptions.not(".jcsdl-advanced").each(function(){var a=e(this);a.html(a.data("textLong"))}),this.$advancedOptions.hide());!a&&this.logic!==b&&this.trigger("logicChange",[this.logic])}}});JCSDL.Loader.addComponent(function(e,j){this.GUI=function(b,a){var c=e(b);if(0==c.length)return!1;this.$el=c.eq(0);this.$container=null;this.config=e.extend(!0,{animate:200,cancelButton:!0,saveButton:null,googleMapsApiKey:"",mapsOverlay:{strokeWeight:0,fillColor:"#7585dd",fillOpacity:0.5},mapsMarker:null,zeroClipboard:null,hideTargets:[],showTargets:[],definition:{},change:function(){},save:function(){},saveError:function(){},cancel:function(){this.hide()},invalidJCSDL:function(){},viewModeChange:function(){},
filterNew:function(){},filterEdit:function(){},filterDelete:function(){},filterSave:function(){},filterCancel:function(){},targetSelect:function(){},operatorSelect:function(){},caseSensitivityChange:function(){},logicChange:function(){},logicError:function(){},advancedLogicChange:function(){},manualLogic:function(){},manualLogicChange:function(){},graphicalLogic:function(){},graphicalLogicChange:function(){},graphicalLogicTokenMove:function(){},parenthesisAdd:function(){},parenthesisDelete:function(){},
logicOperatorSwitch:function(){},targetHelpUrl:function(a,b){if(b.helpUrl)return b.helpUrl;a=a.replace(/\./g,"-");return this.definition.targetHelpJsonpSource.replace(/\{target\}/g,a)}},a);this.definition=e.extend(!0,JCSDLDefinition,this.config.definition);this.parser=new JCSDL.Parser(this);this.logic=null;this.inputs=new JCSDL.GUIInputs(this);this.filters=[];this.$filtersList=this.$mainView=this.currentFilterIndex=null;this.init()};this.GUI.prototype={changeEvents:["filterNew","filterDelete","filterSave",
"logicChange","advancedLogicChange"],init:function(){var b=this;this.filters=[];this.currentFilterIndex=null;this.$mainView=this.getTemplate("editor");this.$filtersList=this.$mainView.find(".jcsdl-filters-list");this.$container=this.getTemplate("container");this.$container.html(this.$mainView);this.$el.html(this.$container);this.$saveButton=this.$mainView.find(".jcsdl-editor-save");this.$previewButton=this.$mainView.find(".jcsdl-editor-preview");this.$cancelButton=this.$mainView.find(".jcsdl-editor-cancel");
if(this.config.saveButton&&("object"==typeof this.config.saveButton||"string"==typeof this.config.saveButton))this.$saveButton.remove(),this.$saveButton=e(this.config.saveButton);if(this.config.cancelButton&&("object"==typeof this.config.cancelButton||"string"==typeof this.config.cancelButton))this.$cancelButton.remove(),this.$cancelButton=e(this.config.cancelButton);this.config.cancelButton||this.$cancelButton.hide();var a=/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];a[1]!==j&&"msie"===
a[1]&&(this.$container.addClass("msie"),e("html").addClass("msie"));this.logic=new JCSDL.GUILogic(this,JCSDL.GUILogic.prototype.AND);var a=this.$mainView.find(".jcsdl-elements-sprite:first").css("background-image").replace(/url\((\'|\")?/,"").replace(/(\'|\")?\)$/,""),c=document.createElement("a");c.href=a;a=c.pathname.split("/");a.pop();a.pop();this.assetsUrl=a.join("/")+"/";this.config.mapsMarker||(this.config.mapsMarker=this.assetsUrl+"img/maps-marker.png");this.config.zeroClipboard||(this.config.zeroClipboard=
this.assetsUrl+"swf/ZeroClipboard.swf");this.$mainView.find(".jcsdl-mainview-mode .jcsdl-mainview-mode-option").bind("click touchstart",function(a){a.preventDefault();a.target.blur();a=e(this);var c=a.attr("data-mode");b.$filtersList.removeClass("expanded collapsed");b.$filtersList.addClass(c);b.$mainView.find(".jcsdl-mainview-mode .jcsdl-mainview-mode-option").removeClass("active");a.addClass("active");b.trigger("viewModeChange",[c])});this.$mainView.find(".jcsdl-add-filter").bind("click touchstart",
function(a){a.preventDefault();a.target.blur();b.showFilterEditor()});this.$saveButton.unbind(".jcsdl").bind("click.jcsdl touchstart.jcsdl",function(a){a.preventDefault();a.target.blur();try{var c=b.returnJCSDL();b.trigger("save",[c])}catch(e){b.showError(e),b.trigger("saveError",[e instanceof JCSDL.LogicValidationException?e.message:e])}});this.$previewButton.unbind(".jcsdl").bind("click.jcsdl touchstart.jcsdl",function(a){a.preventDefault();a.target.blur();try{var c=b.returnJCSDL().split("\n"),
h=[];e.each(c,function(a,b){"//"!==b.substr(0,2)&&h.push(b)});var j=h.join("\n"),g="jcsdl-copy-to-clipboard-"+Math.floor(1E4*Math.random());e.jcsdlPopup({title:"CSDL Preview",content:["<p>"+b.highlightCSDL(j)+"</p>",'<a href="#" id="'+g+'" class="jcsdl-btn jcsdl-copy-to-clipboard"><i class="jcsdl-picto jcsdl-elements-sprite"></i></a>'].join("")});var l=e("#"+g).zclip({path:b.config.zeroClipboard,copy:j,afterCopy:function(){clearTimeout(void 0);l.addClass("copied");setTimeout(function(){l.removeClass("copied")},
3E3)}})}catch(k){b.showError(k)}return!1});this.$cancelButton.unbind(".jcsdl").bind("click.jcsdl touchstart.jcsdl",function(a){a.preventDefault();a.target.blur();b.trigger("cancel")})},reset:function(){this.init()},loadJCSDL:function(b){this.init();var a=this;try{var c=this.parser.parseJCSDL(b);this.filters=c.filters;2<=this.filters.length&&this.logic.toggleButtons();this.logic.setLogic(c.logic,!0)}catch(d){return b=d instanceof JCSDL.ValidationException?d.code:b,this.showError(d,b),this.trigger("invalidJCSDL",
[b]),!1}e.each(this.filters,function(b,c){a.createFilterRow(c).appendTo(a.$filtersList)});this.filters.length&&this.$mainView.find(".jcsdl-footer").show();this.config.cancelButton&&this.$cancelButton.show()},returnJCSDL:function(){return this.parser.getJCSDLForFilters(this.filters,this.logic.getLogicString())},adjust:function(){this.editor&&this.editor.adjust()},hide:function(){this.$container.hide()},show:function(){this.$container.show()},trigger:function(b,a){a=a||[];this.$el.trigger(b.toLowerCase(),
a);if("function"==typeof this.config[b])return this.config[b].apply(this,a);-1<e.inArray(b,this.changeEvents)&&this.trigger("change");return null},showFilterEditor:function(b,a){this.$mainView.hide();this.editor=new JCSDL.GUIFilterEditor(this,this.$container,b);if(b!==j&&b)this.currentFilterIndex=a,this.trigger("filterEdit",[b]);else{this.trigger("filterNew");var c=this.filters[this.filters.length-1];c!==j&&this.editor.getView().find(".jcsdl-filter-target .target-"+c.target+":visible").trigger("jcsdlclick")}},
hideFilterEditor:function(b){b="function"==typeof b?b:e.noop;var a=this;this.currentFilterIndex=null;this.editor.getView().fadeOut(this.config.animate,function(){e(this).remove();a.$mainView.show();a.editor=null;b.apply(a,[])})},didSubmitFilter:function(b){var a=this,c=e.noop,d=null!==this.currentFilterIndex?this.filters[this.currentFilterIndex].id:this.createFilterId(),f=this.parser.createFilter(b.target,b.path,b.operator,b.value,b.additional,d);b=this.createFilterRow(f);null!==this.currentFilterIndex?
(this.$filtersList.find(".jcsdl-filter.filter-"+f.id).replaceWith(b),this.filters[this.currentFilterIndex]=f):(b.appendTo(this.$filtersList),this.filters.push(f),c=function(){a.logic.appendFilterToLogicString(f.id)});this.filters.length&&this.$mainView.find(".jcsdl-footer").fadeIn(this.config.animate);2<=this.filters.length&&this.logic.toggleButtons();this.hideFilterEditor(c);this.trigger("filterSave",[f])},deleteFilter:function(b){var a=this.filters[b];this.$filtersList.find(".jcsdl-filter.filter-"+
a.id).remove();this.filters.splice(b,1);this.logic.deleteGuiFilterToken(a.id);this.trigger("filterDelete",[a]);this.filters.length||this.$mainView.find(".jcsdl-footer").fadeOut(this.config.animate);2>this.filters.length&&this.logic.toggleButtons(!1)},showError:function(b,a){if(b instanceof TypeError)throw b;this.clearErrors();if(b instanceof JCSDL.LogicValidationException)return this.logic.showError(b);var c=b instanceof JCSDL.ValidationException?b.message:b,d=this.getTemplate("error");d.find("span").html(c);
d.insertBefore(this.$mainView.find(".jcsdl-footer"));d.hide().fadeIn();console!==j&&console.error(c,arguments);d.animateIntoView(this.config.animate)},clearErrors:function(){this.$mainView.find(".jcsdl-error").remove()},createFilterRow:function(b){var a=this,c=this.getTemplate("filter");c.addClass("filter-"+b.id).data("filterId",b.id).find(".jcsdl-filter-info.id").html(b.id);var d=this.parser.getTargetInfo(b.target),d=this.getTemplate("filterTarget").addClass("selected target-"+b.target).html(d.name);
c.find(".target").html(d);var f=[];e.each(b.fieldPath,function(d,e){f.push(e);var g=a.parser.getFieldInfo(b.target,f),g=a.getTemplate("filterField").addClass("selected icon-"+a.getIconForField(e,g)).html(g.name);c.find(".jcsdl-filter-info.field").append(g)});var d=this.parser.getFieldInfo(b.target,f),h=this.getTemplate("filterOperator").addClass("operator-"+b.operator+" icon-"+b.operator+" selected").attr("title",this.definition.operators[b.operator].description).html(this.definition.operators[b.operator].code.escapeHtml()).tipsy({gravity:"s",
offset:9});c.find(".operator").html(h);if(b.cs){var j=this.getTemplate("filterOperator").addClass("operator-cs icon-cs selected").attr("title","Case Sensitive").html("case sensitive").tipsy({gravity:"s",offset:9});c.find(".jcsdl-filter-info.operator").append(j);j.tipsy("show")}if("exists"!==b.operator){var g=null,j=(g=0<=e.inArray(b.operator,["geo_box","geo_polygon","geo_radius"]))?b.operator:d.input;g&&(this.getTemplate("filterFieldInput").insertAfter(c.find(".jcsdl-filter-info.field")).find(".jcsdl-filter-field-input").addClass("selected icon-"+
b.operator),h.remove());g=this.inputs[j]&&"function"==typeof this.inputs[j].displayValue?this.inputs.exec(j,"displayValue",[d,b.value,b]):this.getTemplate("filterValue").html(b.value.truncate(50).escapeHtml());c.find(".value").addClass("input-"+j).html(g);c.find(".operator").addClass("input-"+j)}else c.find(".value").remove();c.data("filter",b);c.find(".edit").bind("click touchstart",function(d){d.preventDefault();d.target.blur();a.showFilterEditor(b,a.getFilterIndexByElement(c))});c.find(".delete").bind("click touchstart",
function(b){b.preventDefault();b.target.blur();a.deleteFilter(a.getFilterIndexByElement(c))});return c},createFilterId:function(){var b=[],a=1;for(e.each(this.filters,function(a,d){b.push(parseInt(d.id))});0<=e.inArray(a,b);)a++;return a},highlightFilter:function(b,a){a=a===j?!0:!1;this.$filtersList.find(".filter-"+b)[a?"addClass":"removeClass"]("on")},highlightCSDL:function(b){b=b.split("\n");var a=[];e.each(b,function(b,d){d=e.trim(d);d=d.replace(/"[^"]+"/gi,function(a){return'<span class="jcsdl-code-string">'+
a+"</span>"});var f=d.split(" ");if(-1!==e.inArray(f[0].charAt(0),["(",")"])||-1!==e.inArray(f[0],["AND","OR","NOT"]))return d=d.replace(/AND|OR/gi,function(a){return'<span class="jcsdl-code-logical-operator">'+a+"</span>"}),d=d.replace(/NOT/gi,function(a){return'<span class="jcsdl-code-logical-operator-not">'+a+"</span>"}),d=d.replace(/\(|\)/gi,function(a){return'<span class="jcsdl-code-parenthesis">'+a+"</span>"}),a.push(d),!0;f[0]='<span class="jcsdl-code-target">'+f[0]+"</span>";f[1]='<span class="jcsdl-code-operator">'+
f[1]+"</span>";f=f.join(" ");f=f.replace(/[0-9]*\.?[0-9]+/gi,function(a){return'<span class="jcsdl-code-number">'+a+"</span>"});a.push(f)});return'<code class="jcsdl-code">'+a.join("<br>")+"</code>"},getTemplate:function(b){return JCSDL.GUITemplates[b]!==j?JCSDL.GUITemplates[b].clone():e()},getIconForField:function(b,a){return a.icon!==j?a.icon:b},getFilterIndexByElement:function(b){return this.$filtersList.find(".jcsdl-filter").index(b)}};e.fn.jcsdlGui=function(b){function a(a){var c=a.data("jcsdlGui");
c||(c=new JCSDL.GUI(a,b),a.data("jcsdlGui",c));return c}if("string"==typeof b){if(0<=e.inArray(b,["loadJCSDL","adjust"])){var c=[];e.each(arguments,function(a,b){if(0==a)return!0;c.push(b)});this.each(function(){var d=a(e(this));d[b].apply(d,c)})}return this}this.each(function(){a(e(this))});return this};JCSDLGui=function(b,a){return new JCSDL.GUI(b,a)}});(function(){if(window.jQuery)JCSDL.Loader.load();else{var e=document.getElementsByTagName("head"),j=document.createElement("script");j.src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js";j.type="text/javascript";e[0].appendChild(j);JCSDL.Loader.timeout(!0)}})();
